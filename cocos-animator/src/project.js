window.__require=function t(e,n,i){function o(r,s){if(!n[r]){if(!e[r]){var c=r.split("/");if(c=c[c.length-1],!e[c]){var u="function"==typeof __require&&__require;if(!s&&u)return u(c,!0);if(a)return a(c,!0);throw new Error("Cannot find module '"+r+"'")}}var h=n[r]={exports:{}};e[r][0].call(h.exports,function(t){return o(e[r][1][t]||t)},h,h.exports,t,e,n,i)}return n[r].exports}for(var a="function"==typeof __require&&__require,r=0;r<i.length;r++)o(i[r]);return o}({BarItem:[function(t,e,n){"use strict";cc._RF.push(e,"68573mjffVPYZnh778Bdc81","BarItem");var i=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),o=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0});var a=t("../../common/util/Events"),r=cc._decorator,s=r.ccclass,c=r.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.BgNode=null,e.NameLabel=null,e.BgFrames=[],e._stateMachine=null,e._needUpdate=!1,e}return i(e,t),e.prototype.reuse=function(){},e.prototype.unuse=function(){a.default.targetOff(this)},e.prototype.onInit=function(t,e){this._stateMachine=t,this._needUpdate=!0,this.BgNode.getComponent(cc.Sprite).spriteFrame=this._stateMachine.isMain?this.BgFrames[0]:this.BgFrames[1],this.NameLabel.string=t.name,this.getComponent(cc.Button).interactable=!e,this.NameLabel.node.on(cc.Node.EventType.SIZE_CHANGED,this.onLabSizeChanged,this),a.default.targetOn(this)},e.prototype.onDestroy=function(){a.default.targetOff(this)},e.prototype.lateUpdate=function(){if(this._needUpdate){this._needUpdate=!1;var t=this._stateMachine.isMain?35:40;this.node.width=this.NameLabel.node.width+t+15,this.BgNode.width=2*(this.node.width+30)}},e.prototype.onLabSizeChanged=function(){this._needUpdate=!0},e.prototype.onClick=function(){a.default.emit(a.EventName.SET_CUR_STATE_MACHINE,this._stateMachine)},e.prototype.onEventStateNameChanged=function(t){this._stateMachine===t&&(this.NameLabel.string=t.name)},o([c(cc.Node)],e.prototype,"BgNode",void 0),o([c(cc.Label)],e.prototype,"NameLabel",void 0),o([c(cc.SpriteFrame)],e.prototype,"BgFrames",void 0),o([a.preloadEvent(a.EventName.STATE_MACHINE_NAME_CHANGED)],e.prototype,"onEventStateNameChanged",null),e=o([s],e)}(cc.Component);n.default=u,cc._RF.pop()},{"../../common/util/Events":"Events"}],BaseConst:[function(t,e,n){"use strict";cc._RF.push(e,"19b66kRmTZLkqE+3o6TP3/t","BaseConst"),Object.defineProperty(n,"__esModule",{value:!0}),function(t){t[t.COMPLETE=0]="COMPLETE",t[t.BOOLEAN=1]="BOOLEAN",t[t.NUMBER=2]="NUMBER",t[t.TRIGGER=3]="TRIGGER",t[t.AUTO_TRIGGER=4]="AUTO_TRIGGER"}(n.ParamType||(n.ParamType={})),function(t){t[t.EQUAL=0]="EQUAL",t[t.NOTEQUAL=1]="NOTEQUAL",t[t.GREATER=2]="GREATER",t[t.LESS=3]="LESS",t[t.GREATER_EQUAL=4]="GREATER_EQUAL",t[t.LESS_EQUAL=5]="LESS_EQUAL"}(n.LogicType||(n.LogicType={})),function(t){t[t.CHECK_ON_UPDATE=1]="CHECK_ON_UPDATE",t[t.CHECK_ON_COMPLETE=2]="CHECK_ON_COMPLETE",t[t.CHECK_ON_TRIGGER=3]="CHECK_ON_TRIGGER"}(n.CheckType||(n.CheckType={})),n.ANIMATOR_VERSION="1.0.0",cc._RF.pop()},{}],CanvasAdapt:[function(t,e,n){"use strict";cc._RF.push(e,"750342nk9dCDrHnqrriGmB+","CanvasAdapt");var i=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),o=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0});var a=cc._decorator,r=a.ccclass,s=(a.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.onLoad=function(){var t=this;this.adapt(),cc.view.setResizeCallback(function(){t.adapt()})},e.prototype.adapt=function(){var t=cc.Canvas.instance.designResolution.width/cc.Canvas.instance.designResolution.height;cc.winSize.width/cc.winSize.height>t?(cc.Canvas.instance.fitHeight=!0,cc.Canvas.instance.fitWidth=!1):(cc.Canvas.instance.fitHeight=!1,cc.Canvas.instance.fitWidth=!0)},e=o([r],e)}(cc.Component));n.default=s,cc._RF.pop()},{}],ConditionItem:[function(t,e,n){"use strict";cc._RF.push(e,"34d791dpgtNYaAsny1M3+rq","ConditionItem");var i=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),o=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0});var a=t("../../common/util/Events"),r=t("../../constant/BaseConst"),s=cc._decorator,c=s.ccclass,u=s.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.Bg=null,e.ParamName=null,e.LogicNode=null,e.ValueNode=null,e._hasInit=!1,e.condition=null,e}return i(e,t),e.prototype.reuse=function(){},e.prototype.unuse=function(){this._hasInit=!1,a.default.targetOff(this)},e.prototype.onInit=function(t){if(this.Bg.opacity=0,this.condition=t,this.ParamName.string=this.condition.paramItem.paramName,this.condition.paramItem.type===r.ParamType.BOOLEAN)this.LogicNode.active=!1,this.ValueNode.active=!0,this.ValueNode.getChildByName("number").active=!1,this.ValueNode.getChildByName("boolean").active=!0,this.ValueNode.getChildByName("boolean").getComponent(cc.Toggle).isChecked=0!==this.condition.value;else if(this.condition.paramItem.type===r.ParamType.NUMBER){this.LogicNode.active=!0,this.ValueNode.active=!0,this.ValueNode.getChildByName("number").active=!0,this.ValueNode.getChildByName("boolean").active=!1,this.changeLogic(this.condition.logic),this.ValueNode.getChildByName("number").getComponent(cc.EditBox).string=""+this.condition.value}else this.LogicNode.active=!1,this.ValueNode.active=!1;this._hasInit=!0,a.default.targetOn(this)},e.prototype.onLoad=function(){this.Bg.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this)},e.prototype.onDestroy=function(){a.default.targetOff(this)},e.prototype.onReset=function(t){if(this.condition.reset(t),this.ParamName.string=this.condition.paramItem.paramName,this.condition.paramItem.type===r.ParamType.BOOLEAN)this.LogicNode.active=!1,this.ValueNode.active=!0,this.ValueNode.getChildByName("number").active=!1,this.ValueNode.getChildByName("boolean").active=!0,this.ValueNode.getChildByName("boolean").getComponent(cc.Toggle).isChecked=0!==this.condition.value;else if(this.condition.paramItem.type===r.ParamType.NUMBER){this.LogicNode.active=!0,this.ValueNode.active=!0,this.ValueNode.getChildByName("number").active=!0,this.ValueNode.getChildByName("boolean").active=!1,this.changeLogic(this.condition.logic),this.ValueNode.getChildByName("number").getComponent(cc.EditBox).string=""+this.condition.value}else this.LogicNode.active=!1,this.ValueNode.active=!1},e.prototype.changeLogic=function(t){this.condition.logic=t;var e=this.LogicNode.getChildByName("lab").getComponent(cc.Label);t===r.LogicType.EQUAL?e.string="===":t===r.LogicType.NOTEQUAL?e.string="!==":t===r.LogicType.GREATER?e.string=">":t===r.LogicType.LESS?e.string="<":t===r.LogicType.GREATER_EQUAL?e.string=">=":t===r.LogicType.LESS_EQUAL&&(e.string="<=")},e.prototype.select=function(t){this.Bg.opacity=t?255:0},e.prototype.onTouchStart=function(){this._hasInit&&a.default.emit(a.EventName.CONDITION_SELECT,this)},e.prototype.onClickParamSelect=function(t){var e=t.target;a.default.emit(a.EventName.SHOW_PARAM_SELECT,e,this),this._hasInit&&a.default.emit(a.EventName.CONDITION_SELECT,this)},e.prototype.onClickLogicSelect=function(t){var e=t.target,n=e.parent.convertToWorldSpaceAR(e.position.sub(cc.v2(0,0)));a.default.emit(a.EventName.SHOW_LOGIC,n,e.height,this),this._hasInit&&a.default.emit(a.EventName.CONDITION_SELECT,this)},e.prototype.onValueBoolCheckd=function(t){this.condition.value=t.isChecked?1:0,this._hasInit&&a.default.emit(a.EventName.CONDITION_SELECT,this)},e.prototype.onValueNumberEditBegan=function(){this._hasInit&&a.default.emit(a.EventName.CONDITION_SELECT,this)},e.prototype.onValueNumberChanged=function(t,e){if(""!==(t=t.replace(/[^-.\d]/g,""))){var n=parseFloat(t);this.condition.value=isNaN(n)?0:n,e.string=""+this.condition.value}},e.prototype.onEventParamChanged=function(t){this.condition.paramItem===t&&(this.ParamName.string=this.condition.paramItem.paramName)},o([u(cc.Node)],e.prototype,"Bg",void 0),o([u(cc.Label)],e.prototype,"ParamName",void 0),o([u(cc.Node)],e.prototype,"LogicNode",void 0),o([u(cc.Node)],e.prototype,"ValueNode",void 0),o([a.preloadEvent(a.EventName.PARAM_NAME_CHANGED)],e.prototype,"onEventParamChanged",null),e=o([c],e)}(cc.Component);n.default=h,cc._RF.pop()},{"../../common/util/Events":"Events","../../constant/BaseConst":"BaseConst"}],Condition:[function(t,e,n){"use strict";cc._RF.push(e,"2ad764HKspAr4uxOpB4K/N1","Condition"),Object.defineProperty(n,"__esModule",{value:!0});var i=t("../../constant/BaseConst"),o=function(){function t(t){this._paramItem=null,this.value=0,this.logic=i.LogicType.EQUAL,this.reset(t)}return Object.defineProperty(t.prototype,"paramItem",{get:function(){return this._paramItem},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){},t.prototype.reset=function(t){this._paramItem=t,this.value=0,this.logic=i.LogicType.EQUAL},t.prototype.getConditionData=function(){return{param:this._paramItem.paramName,value:this.value,logic:this.logic}},t}();n.default=o,cc._RF.pop()},{"../../constant/BaseConst":"BaseConst"}],DragItem:[function(t,e,n){"use strict";cc._RF.push(e,"47200PBL7RET6TLrzwacOnB","DragItem");var i=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),o=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0});var a=cc._decorator,r=a.ccclass,s=(a.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._startRect=null,e._toIdx=0,e}return i(e,t),Object.defineProperty(e.prototype,"startRect",{get:function(){return this._startRect},enumerable:!0,configurable:!0}),e.prototype.onInit=function(t){this._toIdx=t,this._startRect=this.node.getBoundingBox()},e.prototype.moveTo=function(t,e){if(t!==this._toIdx){this._toIdx=t,this.node.stopAllActions();var n=cc.moveTo(Math.abs(this.node.y-e)/200,cc.v2(0,e));this.node.runAction(n)}},e.prototype.stop=function(){this.node.stopAllActions()},e=o([r],e)}(cc.Component));n.default=s,cc._RF.pop()},{}],DragList:[function(t,e,n){"use strict";cc._RF.push(e,"5b5cdPJhQlKt4LXUMwNmf/i","DragList");var i=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),o=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0});var a=t("../util/Tool"),r=t("./DragItem"),s=cc._decorator,c=s.ccclass,u=(s.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._dragIdx=-1,e._items=[],e._dragCall=null,e._target=null,e._layout=null,e.canDrag=!0,e}return i(e,t),Object.defineProperty(e.prototype,"layout",{get:function(){return this._layout||(this._layout=this.getComponent(cc.Layout)),this._layout},enumerable:!0,configurable:!0}),e.prototype.onLoad=function(){this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},e.prototype.onTouchStart=function(t){var e=this;if(!this.canDrag||this.node.childrenCount<=1)this._dragIdx=-1;else{var n=this.node.convertToNodeSpaceAR(t.getLocation());this._dragIdx=this.getItemIdx(n),this._dragIdx<0||(this.layout.enabled=!1,this._items=[],this.node.children.forEach(function(t,n){var i=t.getComponent(r.default);i||(i=t.addComponent(r.default)),i.onInit(n),e._items.push(i)}),this._items[this._dragIdx].node.setSiblingIndex(this.node.childrenCount-1))}},e.prototype.onTouchMove=function(t){var e=this;if(!(this._dragIdx<0)){var n=this.node.convertToNodeSpaceAR(t.getLocation()),i=this._items[0].startRect.center.y,o=this._items[this._items.length-1].startRect.center.y;this._items[this._dragIdx].node.y=cc.misc.clampf(n.y,o,i);var r=this.getCurIdx(n);r<this._dragIdx?this._items.forEach(function(t,n){n!==e._dragIdx&&(a.default.inRange(r,e._dragIdx-1,n)?t.moveTo(n+1,e._items[n+1].startRect.center.y):t.moveTo(n,e._items[n].startRect.center.y))}):this._items.forEach(function(t,n){n!==e._dragIdx&&(a.default.inRange(e._dragIdx+1,r,n)?t.moveTo(n-1,e._items[n-1].startRect.center.y):t.moveTo(n,e._items[n].startRect.center.y))})}},e.prototype.onTouchEnd=function(t){if(!(this._dragIdx<0)){var e=this.node.convertToNodeSpaceAR(t.getLocation()),n=this.getCurIdx(e);this._items[this._dragIdx].node.setSiblingIndex(n),this._items.forEach(function(t){t.stop()}),n!==this._dragIdx&&this._dragCall&&(this._target?this._dragCall.call(this._target,this._dragIdx,n):this._dragCall(this._dragIdx,n)),this.layout.enabled=!0,this.layout.updateLayout(),this._dragIdx=-1,this._items=[]}},e.prototype.getItemIdx=function(t){for(var e=0;e<this.node.childrenCount;e++){if(this.node.children[e].getBoundingBox().contains(t))return e}return-1},e.prototype.getCurIdx=function(t){var e=this._items[0].startRect.center.y,n=this._items[this._items.length-1].startRect.center.y;if(t.y>=e)return 0;if(t.y<=n)return this._items.length-1;for(var i=0,o=Math.abs(this._items[0].startRect.center.y-t.y),a=1;a<this._items.length;a++){var r=this._items[a],s=Math.abs(r.startRect.center.y-t.y);if(!(s<o))break;i=a,o=s}return i},e.prototype.setDragCall=function(t,e){this._dragCall=t,this._target=e},e=o([c],e)}(cc.Component));n.default=u,cc._RF.pop()},{"../util/Tool":"Tool","./DragItem":"DragItem"}],Editor:[function(t,e,n){"use strict";cc._RF.push(e,"2ddcfrP02BIIoRNy3vGHwlo","Editor");var i=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),o=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0});var a=t("../common/util/Tool"),r=t("./fsm/FsmCtr"),s=t("./inspector/InspectorCtr"),c=t("./menu/Menu"),u=t("./parameters/ParamCtr"),h=t("./Setting"),l=cc._decorator,p=l.ccclass,d=l.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.Fsm=null,e.Inspector=null,e.Parameters=null,e.Menu=null,e._keySet=new Set,e}return i(e,t),e.prototype.onLoad=function(){h.default.read(),this.Inspector.node.width=h.default.inspectorWidth,this.Inspector.getComponent(cc.Widget).updateAlignment(),a.default.updateWidget(this.Inspector.node),this.Parameters.node.width=h.default.parametersWidth,this.Parameters.getComponent(cc.Widget).updateAlignment(),a.default.updateWidget(this.Parameters.node),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this)},e.prototype.onDestroy=function(){cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this)},e.prototype.onKeyDown=function(t){switch(this._keySet.add(t.keyCode),t.keyCode){case cc.macro.KEY.s:this._keySet.has(cc.macro.KEY.ctrl)&&this.exportProject();break;case cc.macro.KEY.e:this._keySet.has(cc.macro.KEY.ctrl)&&this.exportRuntimeData();break;case cc.macro.KEY.Delete:this.Fsm.deleteCurUnit(),this.Fsm.deleteCurLine()}},e.prototype.onKeyUp=function(t){this._keySet.delete(t.keyCode)},e.prototype.exportProject=function(){var t=this.Fsm.exportProject();t.parameters=this.Parameters.export(),this.save("animator.json",t)},e.prototype.exportRuntimeData=function(){var t=this.Fsm.exportRuntimeData();t.parameters=this.Parameters.export(),this.save("runtimeData.json",t)},e.prototype.save=function(t,e){var n=JSON.stringify(e),i=document.createElement("a");i.download=""+t,i.style.display="none";var o=new Blob([n]);i.href=URL.createObjectURL(o),document.body.appendChild(i),i.click(),document.body.removeChild(i)},e.Inst=null,o([d(r.default)],e.prototype,"Fsm",void 0),o([d(s.default)],e.prototype,"Inspector",void 0),o([d(u.default)],e.prototype,"Parameters",void 0),o([d(c.default)],e.prototype,"Menu",void 0),e=o([p],e)}(cc.Component);n.default=f,cc._RF.pop()},{"../common/util/Tool":"Tool","./Setting":"Setting","./fsm/FsmCtr":"FsmCtr","./inspector/InspectorCtr":"InspectorCtr","./menu/Menu":"Menu","./parameters/ParamCtr":"ParamCtr"}],Events:[function(t,e,n){"use strict";var i;cc._RF.push(e,"438a2ZPUYFPFIMwW3AKuOrH","Events"),Object.defineProperty(n,"__esModule",{value:!0}),function(t){t[t.RESIZE=0]="RESIZE",t[t.PARAM_DELETE=1]="PARAM_DELETE",t[t.PARAM_NAME_CHANGED=2]="PARAM_NAME_CHANGED",t[t.PARAM_SELECT=3]="PARAM_SELECT",t[t.SET_CUR_STATE_MACHINE=4]="SET_CUR_STATE_MACHINE",t[t.STATE_NAME_CHANGED=5]="STATE_NAME_CHANGED",t[t.ANY_STATE_MOVE=6]="ANY_STATE_MOVE",t[t.STATE_MACHINE_NAME_CHANGED=7]="STATE_MACHINE_NAME_CHANGED",t[t.UP_STATE_MACHINE_MOVE=8]="UP_STATE_MACHINE_MOVE",t[t.LINE_TO_MACHINE_STATE=9]="LINE_TO_MACHINE_STATE",t[t.LINE_DELETE=10]="LINE_DELETE",t[t.TRANSITION_ADD=11]="TRANSITION_ADD",t[t.TRANSITION_DELETE=12]="TRANSITION_DELETE",t[t.TRANSITION_SELECT=13]="TRANSITION_SELECT",t[t.CONDITION_SELECT=14]="CONDITION_SELECT",t[t.MULTIPLIER_SELECT=15]="MULTIPLIER_SELECT",t[t.INSPECTOR_HIDE=16]="INSPECTOR_HIDE",t[t.INSPECTOR_SHOW_UNIT=17]="INSPECTOR_SHOW_UNIT",t[t.INSPECTOR_SHOW_LINE=18]="INSPECTOR_SHOW_LINE",t[t.CLOSE_MENU=19]="CLOSE_MENU",t[t.SHOW_RIGHT_MENU=20]="SHOW_RIGHT_MENU",t[t.SHOW_LINE_TO_List=21]="SHOW_LINE_TO_List",t[t.SHOW_PARAM_ADD=22]="SHOW_PARAM_ADD",t[t.SHOW_PARAM_SELECT=23]="SHOW_PARAM_SELECT",t[t.SHOW_LOGIC=24]="SHOW_LOGIC",t[t.SHOW_MULTIPLIER=25]="SHOW_MULTIPLIER"}(i=n.EventName||(n.EventName={})),n.preloadEvent=function(t){return function(e,n,a){var r=o.classMap.get(e.constructor);if(void 0===r)r=[],o.classMap.set(e.constructor,r);else if(r.find(function(e){return e.event===t&&e.funcName===n}))return void cc.error("event: "+i[t]+" \u91cd\u590d\u8f7d\u5165");r.push({event:t,funcName:n})}};var o=function(){function t(){}return t.targetOn=function(t,e){var n=this;if(void 0===e&&(e=!0),e)this.classMap.forEach(function(e,i){t instanceof i&&e.forEach(function(e){n.on(e.event,t[e.funcName],t)})});else{var i=this.classMap.get(t.constructor);i&&i.forEach(function(e){n.on(e.event,t[e.funcName],t)})}},t.on=function(t,e,n){if(e&&n){var o=this._eventsMap.get(t),a=[];if(void 0===o)(o=new Map).set(n,a),this._eventsMap.set(t,o);else if(void 0===(a=o.get(n)))a=[],o.set(n,a);else if(a.find(function(t){return t===e}))return void cc.error("event: "+i[t]+" \u91cd\u590d\u6ce8\u518c");a.push(e)}else cc.error("event: "+i[t]+" listener\u6216target\u4e0d\u80fd\u4e3a\u7a7a")},t.off=function(t,e,n){if(e&&n){var o=this._eventsMap.get(t);if(void 0!==o){var a=o.get(n);if(void 0!==a){var r=a.findIndex(function(t){return t===e});r<0?cc.error("event: "+i[t]+" target\u4e0a\u672a\u4ee5\u8be5listener\u6ce8\u518c\u8be5\u4e8b\u4ef6"):(a.splice(r,1),a.length<=0&&(o.delete(n),o.size<=0&&this._eventsMap.delete(t)))}else cc.error("event: "+i[t]+" target\u4e0a\u672a\u6ce8\u518c\u8be5\u4e8b\u4ef6")}else cc.error("event: "+i[t]+" \u672a\u6ce8\u518c\u8be5\u4e8b\u4ef6")}else cc.error("event: "+i[t]+" listener\u6216target\u4e0d\u80fd\u4e3a\u7a7a")},t.targetOff=function(t){var e=this;t?this._eventsMap.forEach(function(n,i){n.delete(t),n.size<=0&&e._eventsMap.delete(i)}):cc.error("event: "+t+" target\u4e0d\u80fd\u4e3a\u7a7a")},t.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var o=this._eventsMap.get(t);void 0!==o?o.forEach(function(t,n){t.forEach(function(t){t.call.apply(t,[n].concat(e))})}):cc.warn("event: "+i[t]+" \u672a\u6ce8\u518c\u8be5\u4e8b\u4ef6")},t._eventsMap=new Map,t.classMap=new Map,t}();n.default=o,cc._RF.pop()},{}],FsmCtr:[function(t,e,n){"use strict";cc._RF.push(e,"323aev+FNFKzY6VtghchZnd","FsmCtr");var i=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),o=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0});var a=t("../../common/util/Events"),r=t("../../common/util/Tool"),s=t("../../constant/BaseConst"),c=t("../data/State"),u=t("../data/StateMachine"),h=t("../Editor"),l=t("./MachineLayer"),p=t("./UnitState"),d=t("./UnitStateMachine"),f=cc._decorator,_=f.ccclass,m=f.property,y=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.MachineLayer=null,e.Cross=null,e._curMouseBtn=null,e._moveUnitOffset=cc.v2(0,0),e._moveUnit=null,e._curUnit=null,e._tempLine=null,e._curLine=null,e._lastClickTime=0,e}return i(e,t),e.prototype.onLoad=function(){this.node.on(cc.Node.EventType.MOUSE_DOWN,this.onMouseDown,this),this.node.on(cc.Node.EventType.MOUSE_UP,this.onMouseUp,this),this.node.on(cc.Node.EventType.MOUSE_ENTER,this.onMouseEnter,this),this.node.on(cc.Node.EventType.MOUSE_MOVE,this.onMouseMove,this),this.node.on(cc.Node.EventType.MOUSE_LEAVE,this.onMouseLeave,this),this.node.on(cc.Node.EventType.MOUSE_WHEEL,this.onMouseWheel,this),a.default.targetOn(this)},e.prototype.onDestroy=function(){a.default.targetOff(this)},e.prototype.lateUpdate=function(){this._moveUnit&&this.MachineLayer.checkMoveUnit(this._moveUnit)?this.Cross.active=!0:this.Cross.active=!1},e.prototype.onMouseDownLeft=function(t,e){var n=this.MachineLayer.getUnitByPos(e);if(n instanceof p.default){if(n.isAnyState&&this.deleteLine(this._tempLine),this._curLine&&this._curLine.select(!1),this._curLine=null,this._moveUnitOffset=e.sub(n.node.position),this._moveUnit=n,this._curUnit!==n)if(this._tempLine){this._moveUnit=null;var i=this.MachineLayer.getLineByUnit(this._curUnit,n);this._curUnit.addTransition(n,n.state),i?this.deleteLine(this._tempLine):(this._tempLine.onInit(this._curUnit,n),this._tempLine=null)}else this._curUnit&&this._curUnit.select(!1),this._curUnit=n,this._curUnit.select(!0),a.default.emit(a.EventName.INSPECTOR_SHOW_UNIT,this._curUnit)}else if(n instanceof d.default){var o=Date.now(),r=o-this._lastClickTime;if(this._lastClickTime=o,this._curUnit===n&&r<500)return void this.setCurStateMachine(n.stateMachine);this._curLine&&this._curLine.select(!1),this._curLine=null,this._moveUnitOffset=e.sub(n.node.position),this._moveUnit=n,this._curUnit!==n&&(this._tempLine?(this._moveUnit=null,a.default.emit(a.EventName.SHOW_LINE_TO_List,t,n,this.MachineLayer.curStateMachine)):(this._curUnit&&this._curUnit.select(!1),this._curUnit=n,this._curUnit.select(!0),a.default.emit(a.EventName.INSPECTOR_SHOW_UNIT,this._curUnit)))}else{this._moveUnit=null,this._curUnit&&this._curUnit.select(!1),this._curUnit=null;var s=this.MachineLayer.getLineByPos(e);s?this._curLine!==s&&(this._curLine&&this._curLine.select(!1),this._curLine=s,this._curLine.select(!0),a.default.emit(a.EventName.INSPECTOR_SHOW_LINE,this._curLine)):(this._curLine&&this._curLine.select(!1),this._curLine=null,a.default.emit(a.EventName.INSPECTOR_HIDE)),this.deleteLine(this._tempLine)}},e.prototype.onMouseDownRight=function(t){var e=this.MachineLayer.getUnitByPos(t);e&&(this._curLine&&this._curLine.select(!1),this._curLine=null,this._moveUnitOffset=t.sub(e.node.position),this._curUnit!==e&&(this._curUnit&&this._curUnit.select(!1),this._curUnit=e,this._curUnit.select(!0),a.default.emit(a.EventName.INSPECTOR_SHOW_UNIT,this._curUnit))),this.deleteLine(this._tempLine)},e.prototype.onMouseDown=function(t){this._curMouseBtn=t.getButton();this.node.convertToNodeSpaceAR(t.getLocation());var e=this.MachineLayer.node.convertToNodeSpaceAR(t.getLocation());this._curMouseBtn===cc.Event.EventMouse.BUTTON_LEFT?this.onMouseDownLeft(t.getLocation(),e):this._curMouseBtn===cc.Event.EventMouse.BUTTON_RIGHT?this.onMouseDownRight(e):(this._curMouseBtn,cc.Event.EventMouse.BUTTON_MIDDLE)},e.prototype.onMouseUp=function(t){this.node.convertToNodeSpaceAR(t.getLocation());var e=this.MachineLayer.node.convertToNodeSpaceAR(t.getLocation());if(this._curMouseBtn===cc.Event.EventMouse.BUTTON_LEFT)this._moveUnit&&this.MachineLayer.moveIntoStateMachine(this._moveUnit)&&(this._moveUnit=null,this._curUnit=null,a.default.emit(a.EventName.INSPECTOR_HIDE));else if(this._curMouseBtn===cc.Event.EventMouse.BUTTON_RIGHT){var n=this.MachineLayer.getUnitByPos(e),i=this._curUnit&&this._curUnit===n?this._curUnit:null;a.default.emit(a.EventName.SHOW_RIGHT_MENU,t.getLocation(),i)}else this._curMouseBtn,cc.Event.EventMouse.BUTTON_MIDDLE;this._curMouseBtn=null},e.prototype.onMouseEnter=function(t){null===t.getButton()&&(this._curMouseBtn=null)},e.prototype.onMouseMove=function(t){var e=this.node.convertToNodeSpaceAR(t.getLocation()),n=this.MachineLayer.node.convertToNodeSpaceAR(t.getLocation());if(null===t.getButton()&&(this._curMouseBtn=null),this._curUnit&&this._tempLine){var i=this.MachineLayer.getUnitByPos(n);i&&i!==this._curUnit&&(i instanceof p.default&&!i.isAnyState||i instanceof d.default)?this._tempLine.setLine(this._curUnit.node.position,i.node.position):this._tempLine.setLine(this._curUnit.node.position,n)}this._curMouseBtn===cc.Event.EventMouse.BUTTON_LEFT?this._moveUnit&&(this._moveUnit.setPos(n.sub(this._moveUnitOffset)),this.Cross.position=e):this._curMouseBtn===cc.Event.EventMouse.BUTTON_RIGHT||this._curMouseBtn===cc.Event.EventMouse.BUTTON_MIDDLE&&this.MachineLayer.setPos(this.MachineLayer.node.position.add(t.getDelta()))},e.prototype.onMouseLeave=function(t){null===t.getButton()&&(this._curMouseBtn=null)},e.prototype.onMouseWheel=function(t){this.MachineLayer.changeScale(t.getScrollY()>0,t.getLocation())},e.prototype.setCurStateMachine=function(t){this.MachineLayer.curStateMachine!==t&&(this._lastClickTime=0,this._moveUnit=null,this._curUnit=null,this._tempLine=null,this._curLine=null,this.MachineLayer.setCurStateMachine(t),a.default.emit(a.EventName.INSPECTOR_HIDE))},e.prototype.deleteLine=function(t){t&&(this._curLine===t&&(this._curLine=null),this._tempLine===t&&(this._tempLine=null),this.MachineLayer.deleteLine(t))},e.prototype.deleteCurLine=function(){this._curLine&&(this.deleteLine(this._curLine),a.default.emit(a.EventName.INSPECTOR_HIDE))},e.prototype.deleteCurUnit=function(){if(this._curUnit){if(this._curUnit instanceof p.default){if(this._curUnit.isAnyState)return;this.MachineLayer.deleteState(this._curUnit)}else if(this._curUnit instanceof d.default){if(this._curUnit.isUp)return;this.MachineLayer.deleteStateMachine(this._curUnit)}this._curUnit=null,this._moveUnit=null,this.deleteLine(this._tempLine),a.default.emit(a.EventName.INSPECTOR_HIDE)}},e.prototype.onClickCreateState=function(t){a.default.emit(a.EventName.CLOSE_MENU);var e=h.default.Inst.Menu.RightMenu,n=this.MachineLayer.node.convertToNodeSpaceAR(e.parent.convertToWorldSpaceAR(e.position));this.MachineLayer.createState(n)},e.prototype.onClickCreateSubMachine=function(){a.default.emit(a.EventName.CLOSE_MENU);var t=h.default.Inst.Menu.RightMenu,e=this.MachineLayer.node.convertToNodeSpaceAR(t.parent.convertToWorldSpaceAR(t.position));this.MachineLayer.createStateMachine(e)},e.prototype.onClickMakeTrasition=function(){a.default.emit(a.EventName.CLOSE_MENU),this._curUnit&&(this._tempLine=this.MachineLayer.createLine(),this._tempLine.setLine(this._curUnit.node.position,this._curUnit.node.position))},e.prototype.onClickSetDefault=function(){a.default.emit(a.EventName.CLOSE_MENU),this._curUnit&&this._curUnit instanceof p.default&&!this._curUnit.isAnyState&&this.MachineLayer.setDefaultState(this._curUnit)},e.prototype.onClickDeleteCurUnit=function(){a.default.emit(a.EventName.CLOSE_MENU),this.deleteCurUnit()},e.prototype.onEventLineToMachineState=function(t,e){if(this._curUnit&&this._tempLine){this._moveUnit=null;var n=this.MachineLayer.getLineByUnit(this._curUnit,e);this._curUnit.addTransition(e,t),n||this._curUnit instanceof p.default&&this._curUnit.isAnyState?this.deleteLine(this._tempLine):(this._tempLine.onInit(this._curUnit,e),this._tempLine=null)}},e.prototype.onEventLineDelete=function(t){this.deleteLine(t)},e.prototype.onEventSetCurStateMachine=function(t){this.setCurStateMachine(t)},e.prototype.importTransitions=function(t,e,n,i){t.forEach(function(t){var o=n.get(t.toState),a=e.addTransition(o);a.hasExitTime=t.hasExitTime,t.conditions.forEach(function(t){var e=i.get(t.param),n=a.addCondition(e);n.value=t.value,n.logic=t.logic})})},e.prototype.importSubState=function(t,e,n,i,o){t.subStates.forEach(function(t){var a=new c.default(e,!1);i.set(t,a);var r=n.get(t);a.setPosition(r.position[0],r.position[1]),a.name=r.state,a.motion=r.motion,a.speed=r.speed,a.multiplierParam=o.get(r.multiplier)||null,a.loop=r.loop,e.add(a)})},e.prototype.importSubMachine=function(t,e,n,i,o,a,r){var s=this;t.subStateMachines.forEach(function(t){var c=new u.default(e);i.set(t,c);var h=n.get(t);c.setLayerPos(h.layerPos[0],h.layerPos[1]),c.setLayerScale(h.layerScale),c.setAnyStatePos(h.anyStatePos[0],h.anyStatePos[1]),c.name=h.name,c.setPosition(h.position[0],h.position[1]),c.setUpStateMachinePos(h.upStateMachinePos[0],h.upStateMachinePos[1]),e.add(c),s.importSubState(h,c,o,a,r),s.importSubMachine(h,c,n,i,o,a,r)})},e.prototype.exportAllSubMachine=function(t,e){var n=this;e.subStateMachines.forEach(function(e){var i={layerPos:[e.layerPos.x,e.layerPos.y],layerScale:e.layerScale,anyStatePos:[e.anyStatePos.x,e.anyStatePos.y],name:e.name,position:[e.position.x,e.position.y],upStateMachine:e.upStateMachine.name,upStateMachinePos:[e.upStateMachinePos.x,e.upStateMachinePos.y],subStates:[],subStateMachines:[]};e.subStates.forEach(function(t){i.subStates.push(t.name)}),e.subStateMachines.forEach(function(t){i.subStateMachines.push(t.name)}),t.push(i),n.exportAllSubMachine(t,e)})},e.prototype.exportAllState=function(t,e,n){var i=this;void 0===n&&(n=!1),e.subStates.forEach(function(e){var i=null;i=n?{state:e.name,motion:e.motion,speed:e.speed,multiplier:e.getMultiplierName(),loop:e.loop,transitions:e.getAllTransitionData()}:{position:[e.position.x,e.position.y],upStateMachine:e.upStateMachine.name,state:e.name,motion:e.motion,speed:e.speed,multiplier:e.getMultiplierName(),loop:e.loop,transitions:e.getAllTransitionData()},t.push(i)}),e.subStateMachines.forEach(function(e){i.exportAllState(t,e)})},e.prototype.importProject=function(t){var e=this,n=h.default.Inst.Parameters.getParamMap(),i=t.mainStateMachine,o=t.subStateMachines,a=t.defaultState,r=t.anyState,s=t.states,c=new Map;s.forEach(function(t){c.set(t.state,t)});var u=new Map,l=new Map;o.forEach(function(t){l.set(t.name,t)});var p=new Map,d=this.MachineLayer.mainStateMachine;d.setLayerPos(i.layerPos[0],i.layerPos[1]),d.setLayerScale(i.layerScale),d.setAnyStatePos(i.anyStatePos[0],i.anyStatePos[1]),this.importSubState(i,d,c,u,n),this.importSubMachine(i,d,l,p,c,u,n),u.has(a)&&(this.MachineLayer.defaultState=u.get(a)),this.importTransitions(r.transitions,this.MachineLayer.anyState.state,u,n),s.forEach(function(t){var i=u.get(t.state);i||cc.error("error"),e.importTransitions(t.transitions,i,u,n)}),this.MachineLayer.setCurStateMachine()},e.prototype.importAnim=function(t){var e=r.default.randFloat(-this.MachineLayer.node.x-100,100-this.MachineLayer.node.x),n=r.default.randFloat(-this.MachineLayer.node.y-100,100-this.MachineLayer.node.y),i=this.MachineLayer.createState(cc.v2(e,n)).state;i.name=t._name,i.motion=t._name,i.speed=t.speed,i.loop=t.wrapMode===cc.WrapMode.Loop},e.prototype.improtSpine=function(t){for(var e in t.animations){var n=r.default.randFloat(-this.MachineLayer.node.x-100,100-this.MachineLayer.node.x),i=r.default.randFloat(-this.MachineLayer.node.y-100,100-this.MachineLayer.node.y),o=this.MachineLayer.createState(cc.v2(n,i)).state;o.name=e,o.motion=e}},e.prototype.importDragonBones=function(t){var e=this;t.armature.forEach(function(t){t.animation.forEach(function(t){var n=r.default.randFloat(-e.MachineLayer.node.x-100,100-e.MachineLayer.node.x),i=r.default.randFloat(-e.MachineLayer.node.y-100,100-e.MachineLayer.node.y),o=e.MachineLayer.createState(cc.v2(n,i)).state;o.name=t.name,o.motion=t.name,o.loop=0===t.playTimes})})},e.prototype.exportProject=function(){var t=this.MachineLayer.mainStateMachine,e=s.ANIMATOR_VERSION,n={layerPos:[t.layerPos.x,t.layerPos.y],layerScale:t.layerScale,anyStatePos:[t.anyStatePos.x,t.anyStatePos.y],subStates:[],subStateMachines:[]};t.subStates.forEach(function(t){n.subStates.push(t.name)}),t.subStateMachines.forEach(function(t){n.subStateMachines.push(t.name)});var i=[];this.exportAllSubMachine(i,t);var o=this.MachineLayer.defaultState?this.MachineLayer.defaultState.name:"",a={transitions:this.MachineLayer.anyState.state.getAllTransitionData()},r=[];return this.exportAllState(r,t),{animator:e,mainStateMachine:n,subStateMachines:i,defaultState:o,anyState:a,states:r}},e.prototype.exportRuntimeData=function(){var t=this.MachineLayer.mainStateMachine,e=this.MachineLayer.defaultState?this.MachineLayer.defaultState.name:"",n={transitions:this.MachineLayer.anyState.state.getAllTransitionData()},i=[];return this.exportAllState(i,t,!0),{defaultState:e,anyState:n,states:i}},o([m(l.default)],e.prototype,"MachineLayer",void 0),o([m(cc.Node)],e.prototype,"Cross",void 0),o([a.preloadEvent(a.EventName.LINE_TO_MACHINE_STATE)],e.prototype,"onEventLineToMachineState",null),o([a.preloadEvent(a.EventName.LINE_DELETE)],e.prototype,"onEventLineDelete",null),o([a.preloadEvent(a.EventName.SET_CUR_STATE_MACHINE)],e.prototype,"onEventSetCurStateMachine",null),e=o([_],e)}(cc.Component);n.default=y,cc._RF.pop()},{"../../common/util/Events":"Events","../../common/util/Tool":"Tool","../../constant/BaseConst":"BaseConst","../Editor":"Editor","../data/State":"State","../data/StateMachine":"StateMachine","./MachineLayer":"MachineLayer","./UnitState":"UnitState","./UnitStateMachine":"UnitStateMachine"}],InspectorCtr:[function(t,e,n){"use strict";cc._RF.push(e,"af9292xWXVHdYpjOH8rYuVC","InspectorCtr");var i=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),o=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0});var a=t("../../common/cmpt/DragList"),r=t("../../common/util/Events"),s=t("../../common/util/RecyclePool"),c=t("../../common/util/Res"),u=t("../../common/util/Tool"),h=t("../../constant/ResUrl"),l=t("../Editor"),p=t("../fsm/UnitState"),d=t("../fsm/UnitStateMachine"),f=t("../parameters/ParamItem"),_=t("./ConditionItem"),m=t("./TransitionItem"),y=cc._decorator,v=y.ccclass,E=y.property,g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.UnitInfo=null,e.NameNode=null,e.MotionNode=null,e.SpeedNode=null,e.MultiplierNode=null,e.LoopNode=null,e.TransitionInfo=null,e.TransitionList=null,e.ConditionInfo=null,e.ConditionList=null,e.CurTransLab=null,e.HasExitTime=null,e._layout=null,e._transitionInfoLayout=null,e._conditionInfoLayout=null,e._nameEdit=null,e._motionEdit=null,e._speedEdit=null,e._loopToggle=null,e._multiplierLabel=null,e._unit=null,e._line=null,e._transitionItem=null,e._transLayoutDirty=!1,e._conditionItem=null,e._conLayoutDirty=!1,e}return i(e,t),e.prototype.onLoad=function(){this.UnitInfo.active=!1,this.TransitionInfo.active=!1,this.ConditionInfo.active=!1,this._layout=this.getComponent(cc.ScrollView).content.getComponent(cc.Layout),this._transitionInfoLayout=this.TransitionInfo.getComponent(cc.Layout),this._conditionInfoLayout=this.ConditionInfo.getComponent(cc.Layout),this._nameEdit=this.NameNode.children[0].getComponent(cc.EditBox),this._motionEdit=this.MotionNode.children[0].getComponent(cc.EditBox),this._speedEdit=this.SpeedNode.children[0].getComponent(cc.EditBox),this._loopToggle=this.LoopNode.children[0].getComponent(cc.Toggle),this._multiplierLabel=this.MultiplierNode.children[1].getComponent(cc.Label),this.TransitionList.setDragCall(this.transitionDragCall,this),this.ConditionList.setDragCall(this.conditionDragCall,this),r.default.targetOn(this)},e.prototype.onEnable=function(){var t=this.getComponent(cc.ScrollView);t.node.off(cc.Node.EventType.TOUCH_START,t._onTouchBegan,t,!0),t.node.off(cc.Node.EventType.TOUCH_MOVE,t._onTouchMoved,t,!0),t.node.off(cc.Node.EventType.TOUCH_END,t._onTouchEnded,t,!0),t.node.off(cc.Node.EventType.TOUCH_CANCEL,t._onTouchCancelled,t,!0)},e.prototype.onDestroy=function(){r.default.targetOff(this)},e.prototype.lateUpdate=function(){var t=!1;this._transLayoutDirty&&(this._transLayoutDirty=!1,this.TransitionList.node.height=40,this.TransitionList.layout.updateLayout(),this._transitionInfoLayout.updateLayout(),t=!0),this._conLayoutDirty&&(this._conLayoutDirty=!1,this.ConditionList.node.height=40,this.ConditionList.layout.updateLayout(),this._conditionInfoLayout.updateLayout(),t=!0),t&&this._layout.updateLayout()},e.prototype.transitionDragCall=function(t,e){this._unit instanceof p.default&&this._transitionItem&&this._unit.state.moveTransition(t,e)},e.prototype.conditionDragCall=function(t,e){this._transitionItem&&this._conditionItem&&this._transitionItem.transition.moveCondition(t,e)},e.prototype.getTransitionItem=function(){var t=c.default.getLoaded(h.ResUrl.PREFAB.TRANSITION_ITEM),e=s.default.get(m.default)||cc.instantiate(t);return e.width=this.TransitionList.node.width,u.default.updateWidget(e),e},e.prototype.putTransitionItem=function(t){this._transLayoutDirty=!0,s.default.put(m.default,t)},e.prototype.getConditionItem=function(){var t=c.default.getLoaded(h.ResUrl.PREFAB.CONDITION_ITEM),e=s.default.get(_.default)||cc.instantiate(t);return e.width=this.ConditionList.node.width,u.default.updateWidget(e),e},e.prototype.putConditionItem=function(t){this._conLayoutDirty=!0,s.default.put(_.default,t)},e.prototype.showUnitInfo=function(){if(this._unit){if(this._unit instanceof p.default){if(this._unit.isAnyState)return void(this.UnitInfo.active=!1);this.NameNode.active=!0,this.MotionNode.active=!0,this.SpeedNode.active=!0,this.MultiplierNode.active=!0,this.LoopNode.active=!0,this._nameEdit.string=this._unit.state.name,this._motionEdit.string=this._unit.state.motion,this._speedEdit.string=""+this._unit.state.speed,this._loopToggle.isChecked=this._unit.state.loop,this._multiplierLabel.string=this._unit.state.getMultiplierName()}else this._unit instanceof d.default&&(this.NameNode.active=!0,this.MotionNode.active=!1,this.SpeedNode.active=!1,this.MultiplierNode.active=!1,this.LoopNode.active=!1,this._nameEdit.string=this._unit.stateMachine.name);this.UnitInfo.active=!0}else this.UnitInfo.active=!1},e.prototype.showTransitionInfo=function(){var t=this;this.TransitionInfo.active=!0,this._transitionItem=null;for(var e=this.TransitionList.node.childrenCount-1;e>=0;e--)this.putTransitionItem(this.TransitionList.node.children[e]);if(this._unit){if(this._unit instanceof d.default)return void(this.TransitionInfo.active=!1);this._unit.getTransitions().forEach(function(e){var n=t.getTransitionItem();t.TransitionList.node.addChild(n),n.getComponent(m.default).onInit(e,t._unit)}),this.TransitionList.canDrag=!0}else if(this._line){var n=!0;this._line.getTransitions().forEach(function(e){var i=t.getTransitionItem();t.TransitionList.node.addChild(i);var o=i.getComponent(m.default);o.onInit(e,t._unit),n&&(o.select(n),t._transitionItem=o,n=!1)}),this.TransitionList.canDrag=!1}},e.prototype.showConditionInfo=function(){var t=this;if(this._transitionItem){this.ConditionInfo.active=!0,this.CurTransLab.string=this._transitionItem.transition.getTransStr(),this.HasExitTime.isChecked=this._transitionItem.transition.hasExitTime,this._conditionItem=null;for(var e=this.ConditionList.node.childrenCount-1;e>=0;e--)this.putConditionItem(this.ConditionList.node.children[e]);this._transitionItem.transition.conditions.forEach(function(e){var n=t.getConditionItem();t.ConditionList.node.addChild(n),n.getComponent(_.default).onInit(e)})}else this.ConditionInfo.active=!1},e.prototype.hide=function(){this._unit=null,this._line=null,this.UnitInfo.active=!1,this.TransitionInfo.active=!1,this.ConditionInfo.active=!1},e.prototype.onNameChanged=function(){if(this._unit instanceof p.default){if(""===this._nameEdit.string)return void(this._nameEdit.string=this._unit.state.name);this._unit.state.name=this._nameEdit.string,this._nameEdit.string=this._unit.state.name}else if(this._unit instanceof d.default){if(""===this._nameEdit.string)return void(this._nameEdit.string=this._unit.stateMachine.name);this._unit.stateMachine.name=this._nameEdit.string,this._nameEdit.string=this._unit.stateMachine.name}},e.prototype.onMotionChanged=function(){this._unit instanceof p.default&&(this._unit.state.motion=this._motionEdit.string)},e.prototype.onSpeedChanged=function(){if(this._unit instanceof p.default&&(this._speedEdit.string=this._speedEdit.string.replace(/[^.\d]/g,""),""!==this._speedEdit.string)){var t=parseFloat(this._speedEdit.string);this._unit.state.speed=isNaN(t)?1:t,this._speedEdit.string=""+this._unit.state.speed}},e.prototype.onLoopCheckd=function(){this._unit instanceof p.default&&(this._unit.state.loop=this._loopToggle.isChecked)},e.prototype.onClickMultiplier=function(t){this._unit instanceof p.default&&r.default.emit(r.EventName.SHOW_MULTIPLIER,t.target)},e.prototype.onClickDeleteTransition=function(){this._transitionItem&&(this._transitionItem.delete(),this.putTransitionItem(this._transitionItem.node),this._transitionItem=null,this._unit?this.ConditionInfo.active=!1:this.TransitionList.node.childrenCount<=0?this.hide():this.ConditionInfo.active=!1)},e.prototype.onHasExitTimeCheckd=function(){this._transitionItem&&(this._transitionItem.transition.hasExitTime=this.HasExitTime.isChecked)},e.prototype.onClickAddCondition=function(){if(this._transitionItem&&!(l.default.Inst.Parameters.ParamContent.childrenCount<=0)){var t=l.default.Inst.Parameters.ParamContent.children[0].getComponent(f.default),e=this._transitionItem.transition.addCondition(t),n=this.getConditionItem();this.ConditionList.node.addChild(n),n.getComponent(_.default).onInit(e)}},e.prototype.onClickDeleteCondition=function(){this._transitionItem&&this._conditionItem&&(this._transitionItem.transition.deleteCondition(this._conditionItem.condition),this.putConditionItem(this._conditionItem.node),this._conditionItem=null)},e.prototype.onEventStateChanged=function(t){this._transitionItem&&(this.CurTransLab.string=this._transitionItem.transition.getTransStr())},e.prototype.onEventTransitionAdd=function(t,e,n){if(this._unit===t){var i=this.getTransitionItem();this.TransitionList.node.addChild(i),i.getComponent(m.default).onInit(n,this._unit)}},e.prototype.onEventTransitionSelect=function(t){this._transitionItem=t,this.TransitionList.node.children.forEach(function(e){var n=e.getComponent(m.default);n.select(n===t)}),this.showConditionInfo()},e.prototype.onEventConditionSelect=function(t){this._conditionItem=t,this.ConditionList.node.children.forEach(function(e){var n=e.getComponent(_.default);n.select(n===t)})},e.prototype.onEventMultiplierSelect=function(t){this._unit instanceof p.default&&(this._unit.state.multiplierParam=t,this._multiplierLabel.string=this._unit.state.getMultiplierName())},e.prototype.onEventParamDelete=function(t){if(this._transitionItem){this._conditionItem&&this._conditionItem.condition.paramItem===t&&(this._conditionItem=null);for(var e=this.ConditionList.node.childrenCount-1;e>=0;e--){this.ConditionList.node.children[e].getComponent(_.default).condition.paramItem===t&&this.putConditionItem(this.ConditionList.node.children[e])}}},e.prototype.onEventParamChanged=function(t){this._unit instanceof p.default&&this._unit.state.multiplierParam===t&&(this._multiplierLabel.string=this._unit.state.multiplierParam.paramName)},e.prototype.onEventInspectorHide=function(){this.hide()},e.prototype.onEventShowUnit=function(t){this._unit=t,this._line=null,this.showUnitInfo(),this.showTransitionInfo(),this.showConditionInfo()},e.prototype.onEventShowLine=function(t){this._unit=null,this._line=t,this.showUnitInfo(),this.showTransitionInfo(),this.showConditionInfo()},e.prototype.onEventResize=function(t){var e=this;t===this.node&&(u.default.updateWidget(this.node,this.TransitionList.node,this.ConditionList.node),this.TransitionInfo.active&&(this.TransitionList.node.children.forEach(function(t){t.width=e.TransitionList.node.width,u.default.updateWidget(t)}),this.ConditionInfo.active&&this.ConditionList.node.children.forEach(function(t){t.width=e.ConditionList.node.width,u.default.updateWidget(t)})))},o([E(cc.Node)],e.prototype,"UnitInfo",void 0),o([E(cc.Node)],e.prototype,"NameNode",void 0),o([E(cc.Node)],e.prototype,"MotionNode",void 0),o([E(cc.Node)],e.prototype,"SpeedNode",void 0),o([E(cc.Node)],e.prototype,"MultiplierNode",void 0),o([E(cc.Node)],e.prototype,"LoopNode",void 0),o([E(cc.Node)],e.prototype,"TransitionInfo",void 0),o([E(a.default)],e.prototype,"TransitionList",void 0),o([E(cc.Node)],e.prototype,"ConditionInfo",void 0),o([E(a.default)],e.prototype,"ConditionList",void 0),o([E(cc.Label)],e.prototype,"CurTransLab",void 0),o([E(cc.Toggle)],e.prototype,"HasExitTime",void 0),o([r.preloadEvent(r.EventName.STATE_NAME_CHANGED)],e.prototype,"onEventStateChanged",null),o([r.preloadEvent(r.EventName.TRANSITION_ADD)],e.prototype,"onEventTransitionAdd",null),o([r.preloadEvent(r.EventName.TRANSITION_SELECT)],e.prototype,"onEventTransitionSelect",null),o([r.preloadEvent(r.EventName.CONDITION_SELECT)],e.prototype,"onEventConditionSelect",null),o([r.preloadEvent(r.EventName.MULTIPLIER_SELECT)],e.prototype,"onEventMultiplierSelect",null),o([r.preloadEvent(r.EventName.PARAM_DELETE)],e.prototype,"onEventParamDelete",null),o([r.preloadEvent(r.EventName.PARAM_NAME_CHANGED)],e.prototype,"onEventParamChanged",null),o([r.preloadEvent(r.EventName.INSPECTOR_HIDE)],e.prototype,"onEventInspectorHide",null),o([r.preloadEvent(r.EventName.INSPECTOR_SHOW_UNIT)],e.prototype,"onEventShowUnit",null),o([r.preloadEvent(r.EventName.INSPECTOR_SHOW_LINE)],e.prototype,"onEventShowLine",null),o([r.preloadEvent(r.EventName.RESIZE)],e.prototype,"onEventResize",null),e=o([v],e)}(cc.Component);n.default=g,cc._RF.pop()},{"../../common/cmpt/DragList":"DragList","../../common/util/Events":"Events","../../common/util/RecyclePool":"RecyclePool","../../common/util/Res":"Res","../../common/util/Tool":"Tool","../../constant/ResUrl":"ResUrl","../Editor":"Editor","../fsm/UnitState":"UnitState","../fsm/UnitStateMachine":"UnitStateMachine","../parameters/ParamItem":"ParamItem","./ConditionItem":"ConditionItem","./TransitionItem":"TransitionItem"}],LineToSubItem:[function(t,e,n){"use strict";cc._RF.push(e,"6945fjgoidKtqvkf0+V05jV","LineToSubItem");var i=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),o=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0});var a=t("../../common/util/Events"),r=cc._decorator,s=r.ccclass,c=r.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.NameLabel=null,e._state=null,e._toStateMachine=null,e}return i(e,t),e.prototype.onInit=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null),t?(this._state=t,this._toStateMachine=e,this.NameLabel.string=t.name):this.NameLabel.string="<- empty ->"},e.prototype.onClickSelect=function(){a.default.emit(a.EventName.CLOSE_MENU),this._state&&a.default.emit(a.EventName.LINE_TO_MACHINE_STATE,this._state,this._toStateMachine)},o([c(cc.Label)],e.prototype,"NameLabel",void 0),e=o([s],e)}(cc.Component);n.default=u,cc._RF.pop()},{"../../common/util/Events":"Events"}],Line:[function(t,e,n){"use strict";cc._RF.push(e,"2aff7P5LhFCLLzEwzg3mxVI","Line");var i=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),o=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0});var a=t("../../common/util/Events"),r=cc._decorator,s=r.ccclass,c=r.property,u={NORMAL:cc.color(255,255,255),SELECT:cc.color(137,161,255),TEMP:cc.color(50,200,40)},h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.SprNode=null,e.TriNodes=[],e._hasInit=!1,e._needUpdate=!1,e._fromPos=cc.v2(0,0),e._toPos=cc.v2(0,0),e._offset=cc.v2(0,0),e._fromUnit=null,e._toUnit=null,e}return i(e,t),Object.defineProperty(e.prototype,"fromUnit",{get:function(){return this._fromUnit},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"toUnit",{get:function(){return this._toUnit},enumerable:!0,configurable:!0}),e.prototype.onLoad=function(){this.setColor(u.TEMP)},e.prototype.onInit=function(t,e){this._hasInit=!0,this._needUpdate=!0,this._fromUnit=t,this._toUnit=e,this.setColor(u.NORMAL),this.checkSize(this.getTransitions().length),this._fromUnit.node.on(cc.Node.EventType.POSITION_CHANGED,this.onStateMoved,this),this._toUnit.node.on(cc.Node.EventType.POSITION_CHANGED,this.onStateMoved,this),a.default.targetOn(this)},e.prototype.onDestroy=function(){this._hasInit&&(this._fromUnit.node&&this._fromUnit.node.off(cc.Node.EventType.POSITION_CHANGED,this.onStateMoved,this),this._toUnit.node&&this._toUnit.node.off(cc.Node.EventType.POSITION_CHANGED,this.onStateMoved,this),a.default.targetOff(this))},e.prototype.lateUpdate=function(){this._needUpdate&&(this._needUpdate=!0,this.setLine(this._fromUnit.node.position,this._toUnit.node.position))},e.prototype.onStateMoved=function(){this._needUpdate=!0},e.prototype.checkSize=function(t){t>1?(this.TriNodes[1].active=!0,this.TriNodes[2].active=!0):(this.TriNodes[1].active=!1,this.TriNodes[2].active=!1)},e.prototype.setColor=function(t){this.SprNode.color=t,this.TriNodes.forEach(function(e){e.color=t})},e.prototype.getTransitions=function(){return this._hasInit?this._fromUnit.getTransitions(this._toUnit):[]},e.prototype.setLine=function(t,e){var n=cc.v2(e.sub(t));this._offset=this._hasInit?n.rotate(-Math.PI/2).normalize().mul(10):cc.v2(0,0),this._fromPos=t.add(this._offset),this._toPos=e.add(this._offset),this.node.position=this._fromPos.add(this._toPos).mul(.5),this.node.angle=n.equals(cc.Vec2.ZERO)?0:-cc.misc.radiansToDegrees(n.signAngle(cc.v2(0,1))),this.node.height=n.mag(),this.SprNode.height=this.node.height},e.prototype.relatedState=function(t){return this._fromUnit===t||this._toUnit===t},e.prototype.contains=function(t){if(!this._hasInit)return!1;var e=this._offset,n=[this._fromPos.add(e),this._toPos.add(e),this._toPos.sub(e),this._fromPos.sub(e)];return cc.Intersection.pointInPolygon(t,n)},e.prototype.select=function(t){this.setColor(t?u.SELECT:u.NORMAL)},e.prototype.onEventTransitionAdd=function(t,e,n){this._fromUnit===t&&this._toUnit===e&&this.checkSize(this.getTransitions().length)},e.prototype.onEventTransitionDelete=function(t){var e=this.getTransitions();e.length<=0?a.default.emit(a.EventName.LINE_DELETE,this):this.checkSize(e.length)},o([c(cc.Node)],e.prototype,"SprNode",void 0),o([c(cc.Node)],e.prototype,"TriNodes",void 0),o([a.preloadEvent(a.EventName.TRANSITION_ADD)],e.prototype,"onEventTransitionAdd",null),o([a.preloadEvent(a.EventName.TRANSITION_DELETE)],e.prototype,"onEventTransitionDelete",null),e=o([s],e)}(cc.Component);n.default=h,cc._RF.pop()},{"../../common/util/Events":"Events"}],MachineLayer:[function(t,e,n){"use strict";cc._RF.push(e,"8366epRwYlHtLo4LdCIF1d3","MachineLayer");var i=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),o=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0});var a=t("../../common/util/Events"),r=t("../../common/util/Res"),s=t("../../constant/ResUrl"),c=t("../data/State"),u=t("../data/StateMachine"),h=t("./Line"),l=t("./NavBar"),p=t("./UnitBase"),d=t("./UnitState"),f=t("./UnitStateMachine"),_=cc._decorator,m=_.ccclass,y=_.property,v=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.Grid=null,e.UnitContent=null,e.LineContent=null,e.NavBar=null,e._defaultState=null,e._mainStateMachine=null,e._curStateMachine=null,e._anyState=null,e._upUnit=null,e}return i(e,t),Object.defineProperty(e.prototype,"defaultState",{get:function(){return this._defaultState},set:function(t){this._defaultState=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mainStateMachine",{get:function(){return this._mainStateMachine},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"curStateMachine",{get:function(){return this._curStateMachine},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anyState",{get:function(){return this._anyState},enumerable:!0,configurable:!0}),e.prototype.onLoad=function(){this.node.setContentSize(9e3,9e3),this.Grid.setContentSize(9e3,9e3),this._mainStateMachine=new u.default(null),this._curStateMachine=this._mainStateMachine,this._anyState=this.createState(cc.v2(-300,300),!0),this._curStateMachine.setAnyStatePos(this._anyState.node.position),this.NavBar.refreshBar([this._mainStateMachine]),a.default.targetOn(this)},e.prototype.onDestroy=function(){this.clear(),a.default.targetOff(this)},e.prototype.refreshNavBar=function(t){for(var e=[t];t.upStateMachine;)e.unshift(t.upStateMachine),t=t.upStateMachine;this.NavBar.refreshBar(e)},e.prototype.clear=function(){this._mainStateMachine.destroy()},e.prototype.setCurStateMachine=function(t){var e=this;if(void 0===t&&(t=null),this._curStateMachine!==t){if(null===t&&(t=this._curStateMachine),this._curStateMachine=t,this.refreshNavBar(t),t.upStateMachine){if(!this._upUnit){var n=cc.instantiate(r.default.getLoaded(s.ResUrl.PREFAB.STATE_MACHINE_NODE));this.UnitContent.addChild(n);var i=n.getComponent(f.default);this._upUnit=i}this._upUnit.initByStateMachine(t.upStateMachine,t.upStateMachinePos),this._upUnit.isDefault=t.upStateMachine.has(this._defaultState,!1)}else this._upUnit&&(this._upUnit.node.removeFromParent(),this._upUnit.node.destroy(),this._upUnit=null);this._anyState.setPos(t.anyStatePos),this.node.position=t.layerPos,this.node.scale=t.layerScale,this.LineContent.destroyAllChildren(),this.LineContent.removeAllChildren();for(var o=this.UnitContent.childrenCount-1;o>=0;o--){var a=(n=this.UnitContent.children[o]).getComponent(p.default);a!==this._anyState&&a!==this._upUnit&&(n.removeFromParent(),n.destroy())}var c=new Map,u=new Map;this._upUnit&&u.set(t.upStateMachine,this._upUnit),t.subStates.forEach(function(t){var n=cc.instantiate(r.default.getLoaded(s.ResUrl.PREFAB.STATE_NODE));e.UnitContent.addChild(n);var i=n.getComponent(d.default);i.initByState(t),i.isDefault=t===e._defaultState,c.set(t,i)}),t.subStateMachines.forEach(function(t){var n=cc.instantiate(r.default.getLoaded(s.ResUrl.PREFAB.STATE_MACHINE_NODE));e.UnitContent.addChild(n);var i=n.getComponent(f.default);i.initByStateMachine(t),i.isDefault=t.has(e._defaultState),u.size>=1&&u.forEach(function(n,o){o.getTransitions(t).length>0&&e.createLine().onInit(n,i);t.getTransitions(o).length>0&&e.createLine().onInit(i,n)}),u.set(t,i)});var h=c.keys(),l=function(n){var i=h.next().value,o=c.get(i),a=new Set;(i.getTransitions().forEach(function(n){var i=c.get(n.toState);if(!i){if(t.has(n.toState))for(var r=u.keys(),s=0;s<u.size;s++){var h=r.next().value;if(h!==t.upStateMachine&&h.has(n.toState)){i=u.get(h);break}}else i=e._upUnit;if(!i)return void cc.error("[MachineLayer.setCurStateMachine] error transition: "+n)}a.has(i)||(a.add(i),e.createLine().onInit(o,i))}),_._anyState.state.getTransitions(i).length>0)&&_.createLine().onInit(_._anyState,o);for(var r=u.keys(),s=0;s<u.size;s++){var l=r.next().value;if(l.getTransitions(i).length>0)_.createLine().onInit(u.get(l),o)}},_=this;for(o=0;o<c.size;o++)l()}},e.prototype.createStateMachine=function(t){var e=cc.instantiate(r.default.getLoaded(s.ResUrl.PREFAB.STATE_MACHINE_NODE));this.UnitContent.addChild(e);var n=e.getComponent(f.default);return n.onInit(this._curStateMachine),n.setPos(t),n},e.prototype.createState=function(t,e){void 0===e&&(e=!1);var n=cc.instantiate(r.default.getLoaded(s.ResUrl.PREFAB.STATE_NODE));this.UnitContent.addChild(n);var i=n.getComponent(d.default);return i.onInit(this._curStateMachine,e),i.setPos(t),1===c.default.getStateNum()&&this.setDefaultState(i),i},e.prototype.createLine=function(){var t=cc.instantiate(r.default.getLoaded(s.ResUrl.PREFAB.LINE));return this.LineContent.addChild(t),t.getComponent(h.default)},e.prototype.deleteStateMachine=function(t){for(var e=this.LineContent.childrenCount-1;e>=0;e--){var n=this.LineContent.children[e].getComponent(h.default);n.relatedState(t)&&this.deleteLine(n)}this._curStateMachine.delete(t.stateMachine),t.node.removeFromParent(),t.node.destroy(),t.isDefault&&this.setDefaultState()},e.prototype.deleteState=function(t){for(var e=this.LineContent.childrenCount-1;e>=0;e--){var n=this.LineContent.children[e].getComponent(h.default);n.relatedState(t)&&this.deleteLine(n)}this._curStateMachine.delete(t.state),t.node.removeFromParent(),t.node.destroy(),t.isDefault&&this.setDefaultState()},e.prototype.deleteLine=function(t){t.getTransitions().forEach(function(t){t.fromState.deleteTransition(t)}),t.node.removeFromParent(),t.node.destroy()},e.prototype.getUnitByPos=function(t){for(var e=this.UnitContent.childrenCount-1;e>=0;e--){var n=this.UnitContent.children[e];if(n.getBoundingBox().contains(t))return n.getComponent(p.default)}return null},e.prototype.getLineByPos=function(t){for(var e=this.LineContent.childrenCount-1;e>=0;e--){var n=this.LineContent.children[e].getComponent(h.default);if(n.contains(t))return n}return null},e.prototype.getLineByUnit=function(t,e){for(var n=this.LineContent.childrenCount-1;n>=0;n--){var i=this.LineContent.children[n].getComponent(h.default);if(i.fromUnit===t&&i.toUnit===e)return i}return null},e.prototype.checkMoveUnit=function(t){if(t===this._anyState||t===this._upUnit)return null;for(var e=this.UnitContent.childrenCount-1;e>=0;e--){var n=this.UnitContent.children[e],i=n.getComponent(f.default);if(i&&i!==t)if(n.getBoundingBox().contains(t.node.position))return i}return null},e.prototype.moveIntoStateMachine=function(t){var e=this.checkMoveUnit(t);if(!e)return!1;var n=!1;return t instanceof d.default?n=e.stateMachine.moveTargetIn(t.state):t instanceof f.default&&(n=e.stateMachine.moveTargetIn(t.stateMachine)),!!n&&(this.setCurStateMachine(),!0)},e.prototype.setDefaultState=function(t){var e=this;if(void 0===t&&(t=null),t){if(t.state===this._defaultState||t.isAnyState)return;this.UnitContent.children.forEach(function(n){var i=n.getComponent(p.default);i!==e._anyState&&(i===t?(i.isDefault=!0,e._defaultState=t.state):i.isDefault=!1)})}else if(0===this._curStateMachine.subStates.size){if(this._defaultState=c.default.getRandState(),!this._defaultState)return;for(var n=this.UnitContent.childrenCount-1;n>=0;n--){if(i=this.UnitContent.children[n].getComponent(f.default)){i.isDefault=i.stateMachine.has(this._defaultState);break}}}else for(n=this.UnitContent.childrenCount-1;n>=0;n--){var i;if((i=this.UnitContent.children[n].getComponent(d.default))&&!i.isAnyState){i.isDefault=!0,this._defaultState=i.state;break}}},e.prototype.setPos=function(t){var e=this.node.getBoundingBox(),n=cc.misc.clampf(t.x,-this.node.parent.width/2+e.width/2,this.node.parent.width/2-e.width/2),i=cc.misc.clampf(t.y,-this.node.parent.height/2+e.height/2,this.node.parent.height/2-e.height/2);this.node.x=n,this.node.y=i,this._curStateMachine.setLayerPos(n,i)},e.prototype.changeScale=function(t,e){var n=this.node.convertToNodeSpaceAR(e);this.node.scale=cc.misc.clampf(t?this.node.scale+.1:this.node.scale-.1,.3,3);var i=this.node.convertToNodeSpaceAR(e).sub(n).mul(this.node.scale);this.setPos(this.node.position.add(i)),this._curStateMachine.setLayerScale(this.node.scale)},e.prototype.onEventAnyStateMove=function(t){this._curStateMachine.setAnyStatePos(t)},e.prototype.onEventUpStateMachineMove=function(t){this._curStateMachine.setUpStateMachinePos(t)},o([y(cc.Node)],e.prototype,"Grid",void 0),o([y(cc.Node)],e.prototype,"UnitContent",void 0),o([y(cc.Node)],e.prototype,"LineContent",void 0),o([y(l.default)],e.prototype,"NavBar",void 0),o([a.preloadEvent(a.EventName.ANY_STATE_MOVE)],e.prototype,"onEventAnyStateMove",null),o([a.preloadEvent(a.EventName.UP_STATE_MACHINE_MOVE)],e.prototype,"onEventUpStateMachineMove",null),e=o([m],e)}(cc.Component);n.default=v,cc._RF.pop()},{"../../common/util/Events":"Events","../../common/util/Res":"Res","../../constant/ResUrl":"ResUrl","../data/State":"State","../data/StateMachine":"StateMachine","./Line":"Line","./NavBar":"NavBar","./UnitBase":"UnitBase","./UnitState":"UnitState","./UnitStateMachine":"UnitStateMachine"}],Main:[function(t,e,n){"use strict";cc._RF.push(e,"c88fcIQORxDwo+wUWp77jYA","Main");var i=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),o=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r},a=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,a){function r(t){try{c(i.next(t))}catch(t){a(t)}}function s(t){try{c(i.throw(t))}catch(t){a(t)}}function c(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(r,s)}c((i=i.apply(t,e||[])).next())})},r=this&&this.__generator||function(t,e){var n,i,o,a,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(t){return function(e){return c([t,e])}}function c(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=2&a[0]?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,i=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(o=(o=r.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(t){a=[6,t],i=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var s=t("../common/util/Res"),c=t("../constant/ResUrl"),u=t("../editor/Editor"),h=cc._decorator,l=h.ccclass,p=(h.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._editor=null,e}return i(e,t),e.prototype.onLoad=function(){cc.debug.setDisplayStats(!1),this.onInit()},e.prototype.onInit=function(){return a(this,void 0,void 0,function(){return r(this,function(t){switch(t.label){case 0:return[4,s.default.loadDir(c.ResDirUrl.PREFAB,cc.Prefab)];case 1:return t.sent(),this.resetEditor(),this.dragOn(),[2]}})})},e.prototype.resetEditor=function(){this._editor&&(this._editor.Fsm.MachineLayer.clear(),this._editor.node.removeFromParent(),this._editor.node.destroy());var t=cc.instantiate(s.default.getLoaded(c.ResUrl.PREFAB.EDITOR));this._editor=t.getComponent(u.default),u.default.Inst=this._editor,this.node.addChild(t)},e.prototype.dragOn=function(){var t=this;if(cc.sys.isBrowser){var e=document.getElementById("GameCanvas");e.addEventListener("dragenter",function(t){t.preventDefault(),t.stopPropagation()},!1),e.addEventListener("dragover",function(t){t.preventDefault(),t.stopPropagation()},!1),e.addEventListener("dragleave",function(t){t.preventDefault(),t.stopPropagation()},!1),e.addEventListener("drop",function(e){e.preventDefault(),e.stopPropagation();var n=e.dataTransfer.files;t.readFiles(n)},!1)}},e.prototype.readFiles=function(t){for(var e=0;e<t.length;e++){var n=t[e];/\.json$/.test(n.name)?this.readJson(n):/\.anim$/.test(n.name)&&this.readAnim(n)}},e.prototype.readJson=function(t){var e=this,n=new FileReader;n.readAsText(t),n.onload=function(){cc.log(n.result);var t=JSON.parse(n.result);t.animator?(e.resetEditor(),e._editor.Parameters.import(t.parameters),e._editor.Fsm.importProject(t)):t.skeleton&&t.animations?e._editor.Fsm.improtSpine(t):t.armature&&e._editor.Fsm.importDragonBones(t)}},e.prototype.readAnim=function(t){var e=this,n=new FileReader;n.readAsText(t),n.onload=function(){cc.log(n.result);var t=JSON.parse(n.result);e._editor.Fsm.importAnim(t)}},e=o([l],e)}(cc.Component));n.default=p,cc._RF.pop()},{"../common/util/Res":"Res","../constant/ResUrl":"ResUrl","../editor/Editor":"Editor"}],Menu:[function(t,e,n){"use strict";cc._RF.push(e,"c2fcbr7yPJERI8iM3RbEqTq","Menu");var i=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),o=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0});var a=t("../../common/util/Events"),r=t("../../common/util/RecyclePool"),s=t("../../common/util/Res"),c=t("../../common/util/Tool"),u=t("../../constant/BaseConst"),h=t("../../constant/ResUrl"),l=t("../Editor"),p=t("../fsm/UnitState"),d=t("../fsm/UnitStateMachine"),f=t("../parameters/ParamItem"),_=t("./LineToSubItem"),m=t("./MultiplierItem"),y=t("./ParamSelectItem"),v=cc._decorator,E=v.ccclass,g=v.property,S=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.RightMenu=null,e.LineToSubList=null,e.MultiplierList=null,e.ParamAdd=null,e.ParamSelect=null,e.ConditionLogic=null,e._conditionItem=null,e}return i(e,t),e.prototype.onLoad=function(){this.node.active=!1,this.node.on(cc.Node.EventType.TOUCH_START,this.close,this),a.default.targetOn(this)},e.prototype.onDestroy=function(){a.default.targetOff(this)},e.prototype.show=function(t){this.node.active=!0,this.RightMenu.active=this.RightMenu===t,this.LineToSubList.node.active=this.LineToSubList.node===t,this.MultiplierList.node.active=this.MultiplierList.node===t,this.ParamAdd.active=this.ParamAdd===t,this.ParamSelect.node.active=this.ParamSelect.node===t,this.ConditionLogic.active=this.ConditionLogic===t},e.prototype.close=function(){this.node.active=!1},e.prototype.onClickConditionLogic=function(t,e){this.close(),this._conditionItem&&this._conditionItem.changeLogic(parseInt(e))},e.prototype.onEventCloseMenu=function(){this.close()},e.prototype.onEventShowRightMenu=function(t,e){if(void 0===e&&(e=null),this.show(this.RightMenu),e){if(this.RightMenu.getChildByName("create").active=!1,this.RightMenu.getChildByName("state").active=!0,e instanceof p.default)this.RightMenu.getChildByName("state").children[0].active=!0,e.isAnyState?(this.RightMenu.getChildByName("state").children[1].active=!1,this.RightMenu.getChildByName("state").children[2].active=!1):(this.RightMenu.getChildByName("state").children[1].active=!0,this.RightMenu.getChildByName("state").children[2].active=!0);else if(e instanceof d.default){if(e.isUp)return void this.close();this.RightMenu.getChildByName("state").children[0].active=!1,this.RightMenu.getChildByName("state").children[1].active=!1,this.RightMenu.getChildByName("state").children[2].active=!0}this.RightMenu.height=this.RightMenu.getChildByName("state").height}else this.RightMenu.getChildByName("create").active=!0,this.RightMenu.getChildByName("state").active=!1,this.RightMenu.height=this.RightMenu.getChildByName("create").height;var n=this.node.convertToNodeSpaceAR(t),i=n.x,o=n.y-this.RightMenu.height<-this.node.height/2?n.y+this.RightMenu.height:n.y;this.RightMenu.position=cc.v2(i,o)},e.prototype.onEventShowLineToList=function(t,e,n){var i=this;this.show(this.LineToSubList.node);for(var o=this.LineToSubList.content.childrenCount-1;o>=0;o--)r.default.put(_.default,this.LineToSubList.content.children[o]);var a=null;if(0===(a=e.isUp?n.getAllOutStates():e.stateMachine.getAllSubStates()).size){var c=r.default.get(_.default)||cc.instantiate(s.default.getLoaded(h.ResUrl.PREFAB.LINE_TO_SUB_ITEM));this.LineToSubList.content.addChild(c),c.getComponent(_.default).onInit()}else a.forEach(function(t){var n=r.default.get(_.default)||cc.instantiate(s.default.getLoaded(h.ResUrl.PREFAB.LINE_TO_SUB_ITEM));i.LineToSubList.content.addChild(n),n.getComponent(_.default).onInit(t,e)});var u=cc.misc.clampf(this.LineToSubList.content.childrenCount,1,10);this.LineToSubList.node.height=40*u+20,this.LineToSubList.content.parent.height=40*u+20,this.LineToSubList.content.childrenCount>10?(this.LineToSubList.node.getChildByName("scrollBar").active=!0,this.LineToSubList.node.getChildByName("scrollBar").getComponent(cc.Widget).updateAlignment()):this.LineToSubList.node.getChildByName("scrollBar").active=!1;var l=this.node.convertToNodeSpaceAR(t),p=l.x,d=l.y-this.LineToSubList.node.height<-this.node.height/2?l.y+this.LineToSubList.node.height:l.y;this.LineToSubList.node.position=cc.v2(p,d)},e.prototype.onEventShowMultiplierSelect=function(t){var e=this;this.show(this.MultiplierList.node);var n=t.parent.convertToWorldSpaceAR(t.position);n.y-=t.height/2,this.MultiplierList.node.position=this.node.convertToNodeSpaceAR(n);for(var i=this.MultiplierList.content.childrenCount-1;i>=0;i--)r.default.put(m.default,this.MultiplierList.content.children[i]);var o=r.default.get(m.default)||cc.instantiate(s.default.getLoaded(h.ResUrl.PREFAB.MULTIPLIER_ITEM));this.MultiplierList.content.addChild(o),o.getComponent(m.default).onInit(),o.width=t.width,l.default.Inst.Parameters.ParamContent.children.forEach(function(n){var i=n.getComponent(f.default);i.type===u.ParamType.NUMBER&&(o=r.default.get(m.default)||cc.instantiate(s.default.getLoaded(h.ResUrl.PREFAB.MULTIPLIER_ITEM)),e.MultiplierList.content.addChild(o),o.getComponent(m.default).onInit(i),o.width=t.width)});var a=cc.misc.clampf(this.MultiplierList.content.childrenCount,1,10);this.MultiplierList.node.height=40*a+20,this.MultiplierList.content.parent.height=40*a+20,this.MultiplierList.node.width=t.width,c.default.updateWidget(this.MultiplierList.node),this.MultiplierList.node.getChildByName("scrollBar").active=this.MultiplierList.content.childrenCount>10},e.prototype.onEventShowParamAdd=function(t){this.show(this.ParamAdd),this.ParamAdd.position=this.node.convertToNodeSpaceAR(t)},e.prototype.onEventShowParamSelect=function(t,e){var n=this;this.show(this.ParamSelect.node);for(var i=t.parent.convertToWorldSpaceAR(t.position.sub(cc.v2(0,0))),o=this.ParamSelect.content.childrenCount-1;o>=0;o--)r.default.put(y.default,this.ParamSelect.content.children[o]);l.default.Inst.Parameters.ParamContent.children.forEach(function(i){var o=r.default.get(y.default)||cc.instantiate(s.default.getLoaded(h.ResUrl.PREFAB.PARAM_SELECT_ITEM));n.ParamSelect.content.addChild(o),o.getComponent(y.default).onInit(i.getComponent(f.default),e),o.width=t.width});var a=cc.misc.clampf(this.ParamSelect.content.childrenCount,1,10);this.ParamSelect.node.height=40*a+10,this.ParamSelect.content.parent.height=40*a+10,this.ParamSelect.node.width=t.width,c.default.updateWidget(this.ParamSelect.node),this.ParamSelect.node.getChildByName("scrollBar").active=this.ParamSelect.content.childrenCount>10,i.y-t.height/2-this.ParamSelect.node.height>0?this.ParamSelect.node.position=this.node.convertToNodeSpaceAR(cc.v2(i.x,i.y-t.height/2)):this.ParamSelect.node.position=this.node.convertToNodeSpaceAR(cc.v2(i.x,i.y+t.height/2+this.ParamSelect.node.height))},e.prototype.onEventShowLogic=function(t,e,n){this.show(this.ConditionLogic),t.y-e/2-this.ConditionLogic.height>0?this.ConditionLogic.position=this.node.convertToNodeSpaceAR(cc.v2(t.x,t.y-e/2)):this.ConditionLogic.position=this.node.convertToNodeSpaceAR(cc.v2(t.x,t.y+e/2+this.ConditionLogic.height)),this._conditionItem=n},o([g(cc.Node)],e.prototype,"RightMenu",void 0),o([g(cc.ScrollView)],e.prototype,"LineToSubList",void 0),o([g(cc.ScrollView)],e.prototype,"MultiplierList",void 0),o([g(cc.Node)],e.prototype,"ParamAdd",void 0),o([g(cc.ScrollView)],e.prototype,"ParamSelect",void 0),o([g(cc.Node)],e.prototype,"ConditionLogic",void 0),o([a.preloadEvent(a.EventName.CLOSE_MENU)],e.prototype,"onEventCloseMenu",null),o([a.preloadEvent(a.EventName.SHOW_RIGHT_MENU)],e.prototype,"onEventShowRightMenu",null),o([a.preloadEvent(a.EventName.SHOW_LINE_TO_List)],e.prototype,"onEventShowLineToList",null),o([a.preloadEvent(a.EventName.SHOW_MULTIPLIER)],e.prototype,"onEventShowMultiplierSelect",null),o([a.preloadEvent(a.EventName.SHOW_PARAM_ADD)],e.prototype,"onEventShowParamAdd",null),o([a.preloadEvent(a.EventName.SHOW_PARAM_SELECT)],e.prototype,"onEventShowParamSelect",null),o([a.preloadEvent(a.EventName.SHOW_LOGIC)],e.prototype,"onEventShowLogic",null),e=o([E],e)}(cc.Component);n.default=S,cc._RF.pop()},{"../../common/util/Events":"Events","../../common/util/RecyclePool":"RecyclePool","../../common/util/Res":"Res","../../common/util/Tool":"Tool","../../constant/BaseConst":"BaseConst","../../constant/ResUrl":"ResUrl","../Editor":"Editor","../fsm/UnitState":"UnitState","../fsm/UnitStateMachine":"UnitStateMachine","../parameters/ParamItem":"ParamItem","./LineToSubItem":"LineToSubItem","./MultiplierItem":"MultiplierItem","./ParamSelectItem":"ParamSelectItem"}],MultiplierItem:[function(t,e,n){"use strict";cc._RF.push(e,"dbdb20upSVI1Zv4IzoDeRU3","MultiplierItem");var i=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),o=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0});var a=t("../../common/util/Events"),r=cc._decorator,s=r.ccclass,c=r.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.NameLabel=null,e._paramItem=null,e}return i(e,t),e.prototype.onInit=function(t){void 0===t&&(t=null),this._paramItem=t,this._paramItem?this.NameLabel.string=this._paramItem.paramName:this.NameLabel.string="<- empty ->"},e.prototype.onClick=function(){a.default.emit(a.EventName.MULTIPLIER_SELECT,this._paramItem),a.default.emit(a.EventName.CLOSE_MENU)},o([c(cc.Label)],e.prototype,"NameLabel",void 0),e=o([s],e)}(cc.Component);n.default=u,cc._RF.pop()},{"../../common/util/Events":"Events"}],NavBar:[function(t,e,n){"use strict";cc._RF.push(e,"c75813n40xNEIGnfLBegvUx","NavBar");var i=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),o=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0});var a=t("../../common/util/Events"),r=t("../../common/util/RecyclePool"),s=t("../../common/util/Res"),c=t("../../constant/ResUrl"),u=t("../Editor"),h=t("./BarItem"),l=cc._decorator,p=l.ccclass,d=l.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.Content=null,e._widget=null,e._contentWidget=null,e}return i(e,t),e.prototype.onLoad=function(){this._widget=this.getComponent(cc.Widget),this._contentWidget=this.Content.getComponent(cc.Widget),this.onEventResize(),a.default.targetOn(this)},e.prototype.onDestroy=function(){a.default.targetOff(this)},e.prototype.refreshBar=function(t){for(var e=this,n=this.Content.childrenCount-1;n>=0;n--)r.default.put(h.default,this.Content.children[n]);t.forEach(function(n,i){var o=r.default.get(h.default)||cc.instantiate(s.default.getLoaded(c.ResUrl.PREFAB.BAR_ITEM));e.Content.addChild(o),o.getComponent(h.default).onInit(n,i===t.length-1)})},e.prototype.onEventResize=function(t){this._widget.left=u.default.Inst.Parameters.node.width,this._widget.right=u.default.Inst.Inspector.node.width,this._widget.updateAlignment(),this._contentWidget.updateAlignment()},o([d(cc.Node)],e.prototype,"Content",void 0),o([a.preloadEvent(a.EventName.RESIZE)],e.prototype,"onEventResize",null),e=o([p],e)}(cc.Component);n.default=f,cc._RF.pop()},{"../../common/util/Events":"Events","../../common/util/RecyclePool":"RecyclePool","../../common/util/Res":"Res","../../constant/ResUrl":"ResUrl","../Editor":"Editor","./BarItem":"BarItem"}],ParamCtr:[function(t,e,n){"use strict";cc._RF.push(e,"86c893/zz5AbqnVPafNXobP","ParamCtr");var i=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),o=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0});var a=t("../../common/util/Events"),r=t("../../common/util/RecyclePool"),s=t("../../common/util/Res"),c=t("../../common/util/Tool"),u=t("../../constant/ResUrl"),h=t("./ParamItem"),l=cc._decorator,p=l.ccclass,d=l.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ParamContent=null,e.SelectPosNode=null,e}return i(e,t),e.prototype.onLoad=function(){a.default.targetOn(this)},e.prototype.onEnable=function(){var t=this.getComponent(cc.ScrollView);t.node.off(cc.Node.EventType.TOUCH_START,t._onTouchBegan,t,!0),t.node.off(cc.Node.EventType.TOUCH_MOVE,t._onTouchMoved,t,!0),t.node.off(cc.Node.EventType.TOUCH_END,t._onTouchEnded,t,!0),t.node.off(cc.Node.EventType.TOUCH_CANCEL,t._onTouchCancelled,t,!0)},e.prototype.onDestroy=function(){a.default.targetOff(this)},e.prototype.import=function(t){var e=this;t.forEach(function(t){var n=e.getParamItem();e.ParamContent.addChild(n),n.getComponent(h.default).onInit(t.param,t.type,t.init)})},e.prototype.export=function(){var t=[];return this.ParamContent.children.forEach(function(e){var n=e.getComponent(h.default),i={param:n.paramName,type:n.type,init:n.init};t.push(i)}),t},e.prototype.getParamMap=function(){var t=new Map;return this.ParamContent.children.forEach(function(e){var n=e.getComponent(h.default);t.set(n.paramName,n)}),t},e.prototype.getParamItem=function(){var t=s.default.getLoaded(u.ResUrl.PREFAB.PARAM_ITEM),e=r.default.get(h.default)||cc.instantiate(t);return e.width=this.ParamContent.width,c.default.updateWidget(e),e},e.prototype.putParamItem=function(t){r.default.put(h.default,t)},e.prototype.getParamItemByName=function(t){for(var e=0;e<this.ParamContent.childrenCount;e++){var n=this.ParamContent.children[e].getComponent(h.default);if(t===n.paramName)return n}return null},e.prototype.getParamName=function(t,e){void 0===e&&(e="param");for(var n=0,i=!1;!i;){i=!0;for(var o=0;o<this.ParamContent.childrenCount;o++){var a=this.ParamContent.children[o].getComponent(h.default);if(a!==t&&a.paramName===""+e+(n>0?n:"")){n++,i=!1;break}}}return""+e+(n>0?n:"")},e.prototype.onClickAddParam=function(t,e){a.default.emit(a.EventName.CLOSE_MENU);var n=parseInt(e),i=this.getParamItem();this.ParamContent.addChild(i);var o=i.getComponent(h.default);o.onInit(this.getParamName(o),n)},e.prototype.onClickOpenSelect=function(){a.default.emit(a.EventName.SHOW_PARAM_ADD,this.SelectPosNode.parent.convertToWorldSpaceAR(this.SelectPosNode.position))},e.prototype.onEventParamDelete=function(t){this.putParamItem(t.node)},e.prototype.onEventParamSelect=function(t){this.ParamContent.children.forEach(function(e){var n=e.getComponent(h.default);n.select(n===t)})},e.prototype.onEventResize=function(t){var e=this;t===this.node&&(c.default.updateWidget(this.node,this.ParamContent),this.ParamContent.children.forEach(function(t){t.width=e.ParamContent.width,c.default.updateWidget(t)}))},o([d(cc.Node)],e.prototype,"ParamContent",void 0),o([d(cc.Node)],e.prototype,"SelectPosNode",void 0),o([a.preloadEvent(a.EventName.PARAM_DELETE)],e.prototype,"onEventParamDelete",null),o([a.preloadEvent(a.EventName.PARAM_SELECT)],e.prototype,"onEventParamSelect",null),o([a.preloadEvent(a.EventName.RESIZE)],e.prototype,"onEventResize",null),e=o([p],e)}(cc.Component);n.default=f,cc._RF.pop()},{"../../common/util/Events":"Events","../../common/util/RecyclePool":"RecyclePool","../../common/util/Res":"Res","../../common/util/Tool":"Tool","../../constant/ResUrl":"ResUrl","./ParamItem":"ParamItem"}],ParamItem:[function(t,e,n){"use strict";cc._RF.push(e,"37ea8w2l01BzryuRRrDyld2","ParamItem");var i=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),o=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0});var a=t("../../common/util/Events"),r=t("../../constant/BaseConst"),s=t("../Editor"),c=cc._decorator,u=c.ccclass,h=c.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.Bg=null,e.NameEdit=null,e.InitValue=null,e._hasInit=!1,e._paramName="",e.type=null,e.init=0,e}return i(e,t),Object.defineProperty(e.prototype,"paramName",{get:function(){return this._paramName},set:function(t){this._paramName!==t&&(this._paramName=t,this.NameEdit.string=t,a.default.emit(a.EventName.PARAM_NAME_CHANGED,this))},enumerable:!0,configurable:!0}),e.prototype.reuse=function(){},e.prototype.unuse=function(){this._hasInit=!1},e.prototype.onInit=function(t,e,n){void 0===n&&(n=0),this.Bg.opacity=0,this.paramName=t,this.type=e,this.init=n,this.showInitValue(),this._hasInit=!0},e.prototype.onLoad=function(){this.Bg.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this)},e.prototype.showInitValue=function(){var t=this;this.InitValue.children.forEach(function(e,n){e.active=t.type===n+1,e.active&&(t.type===r.ParamType.NUMBER?e.getComponent(cc.EditBox).string=""+t.init:e.getComponent(cc.Toggle).isChecked=1===t.init)})},e.prototype.onTouchStart=function(){this._hasInit&&a.default.emit(a.EventName.PARAM_SELECT,this)},e.prototype.select=function(t){this.Bg.opacity=t?255:0},e.prototype.onNameEditBegan=function(){this._hasInit&&a.default.emit(a.EventName.PARAM_SELECT,this)},e.prototype.onNameChanged=function(){""!==this.NameEdit.string?(this.NameEdit.string=s.default.Inst.Parameters.getParamName(this,this.NameEdit.string),this.paramName=this.NameEdit.string):this.NameEdit.string=this.paramName},e.prototype.onNumberEditBegan=function(){this._hasInit&&a.default.emit(a.EventName.PARAM_SELECT,this)},e.prototype.onNumberChanged=function(t,e){if(""!==(t=t.replace(/[^-.\d]/g,""))){var n=parseFloat(t);this.init=isNaN(n)?0:n,e.string=""+this.init}},e.prototype.onBooleanCheckd=function(t){this.init=t.isChecked?1:0,this._hasInit&&a.default.emit(a.EventName.PARAM_SELECT,this)},e.prototype.onTriggerCheckd=function(t){this.init=t.isChecked?1:0,this._hasInit&&a.default.emit(a.EventName.PARAM_SELECT,this)},e.prototype.onAutoTriggerCheckd=function(t){this.init=t.isChecked?1:0,this._hasInit&&a.default.emit(a.EventName.PARAM_SELECT,this)},e.prototype.onClickDelete=function(){a.default.emit(a.EventName.PARAM_DELETE,this)},o([h(cc.Node)],e.prototype,"Bg",void 0),o([h(cc.EditBox)],e.prototype,"NameEdit",void 0),o([h(cc.Node)],e.prototype,"InitValue",void 0),e=o([u],e)}(cc.Component);n.default=l,cc._RF.pop()},{"../../common/util/Events":"Events","../../constant/BaseConst":"BaseConst","../Editor":"Editor"}],ParamSelectItem:[function(t,e,n){"use strict";cc._RF.push(e,"93f5czButJJz62NWXvqIWnj","ParamSelectItem");var i=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),o=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0});var a=t("../../common/util/Events"),r=cc._decorator,s=r.ccclass,c=r.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ParamName=null,e._paramItem=null,e._conditionItem=null,e}return i(e,t),e.prototype.onInit=function(t,e){this._paramItem=t,this._conditionItem=e,this.ParamName.string=this._paramItem.paramName},e.prototype.onClick=function(){this._conditionItem.onReset(this._paramItem),a.default.emit(a.EventName.CLOSE_MENU)},o([c(cc.Label)],e.prototype,"ParamName",void 0),e=o([s],e)}(cc.Component);n.default=u,cc._RF.pop()},{"../../common/util/Events":"Events"}],RecyclePool:[function(t,e,n){"use strict";cc._RF.push(e,"2650en0bwhIRb+LMa/s56Zr","RecyclePool"),Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(){}return t.size=function(t){var e=this._poolMap.get(t);return void 0===e?0:e.length},t.clear=function(t){var e=this._poolMap.get(t);if(void 0!==e){for(var n=e.length,i=0;i<n;++i)e[i].destroy();e.length=0,this._poolMap.delete(t)}},t.clearAll=function(){this._poolMap.forEach(function(t){t.forEach(function(t){t.destroy()})}),this._poolMap.clear()},t.get=function(t){var e=this._poolMap.get(t);if(void 0===e||e.length<=0)return null;var n=e.length-1,i=e[n];e.length=n;var o=i.getComponent(t);return o&&o.reuse&&o.reuse(),i},t.put=function(t,e){if(e){var n=this._poolMap.get(t);if(void 0===n)n=[],this._poolMap.set(t,n);else if(-1!==n.indexOf(e))return void cc.error("[RecyclePool.put] error: \u4e0d\u53ef\u5c06\u8282\u70b9\u91cd\u590d\u653e\u5165\u8282\u70b9\u6c60\u4e2d");e.removeFromParent(!1);var i=e.getComponent(t);i&&i.unuse&&i.unuse(),n.push(e)}else cc.error("[RecyclePool.put] error: \u4f20\u5165\u8282\u70b9\u4e3a\u7a7a")},t._poolMap=new Map,t}();n.default=i,cc._RF.pop()},{}],ResUrl:[function(t,e,n){"use strict";cc._RF.push(e,"e31cdFpPpVJFaJX4R2vFPge","ResUrl"),Object.defineProperty(n,"__esModule",{value:!0}),n.ResUrl={PREFAB:{EDITOR:"prefab/Editor",STATE_NODE:"prefab/StateNode",STATE_MACHINE_NODE:"prefab/StateMachineNode",LINE:"prefab/Line",BAR_ITEM:"prefab/item/BarItem",TRANSITION_ITEM:"prefab/item/TransitionItem",CONDITION_ITEM:"prefab/item/ConditionItem",PARAM_ITEM:"prefab/item/ParamItem",PARAM_SELECT_ITEM:"prefab/item/ParamSelectItem",LINE_TO_SUB_ITEM:"prefab/item/LineToSubItem",MULTIPLIER_ITEM:"prefab/item/MultiplierItem"}},n.ResDirUrl={PREFAB:"prefab/"},cc._RF.pop()},{}],ResizeArea:[function(t,e,n){"use strict";cc._RF.push(e,"ea7dfwEMRtBBqx2B3k9ylCu","ResizeArea");var i=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),o=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0});var a=t("../../editor/Setting"),r=t("../util/Events"),s=cc._decorator,c=s.ccclass,u=s.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.Target=null,e.Limit=cc.v2(),e.isLeft=!0,e._canvas=null,e._startPos=null,e._startWidth=0,e._updateDirty=!1,e}return i(e,t),e.prototype.onLoad=function(){this._canvas=document.getElementById("GameCanvas"),this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(cc.Node.EventType.MOUSE_ENTER,this.onMouseEnter,this),this.node.on(cc.Node.EventType.MOUSE_LEAVE,this.onMouseLeave,this)},e.prototype.lateUpdate=function(){this._updateDirty&&(this._updateDirty=!1,this.Target.left=0,this.Target.right=0,this.Target.updateAlignment(),r.default.emit(r.EventName.RESIZE,this.Target.node),a.default.save())},e.prototype.onTouchStart=function(t){this._canvas.style.cursor="w-resize",this._startPos=t.getLocation(),this._startWidth=this.Target.node.width},e.prototype.onTouchMove=function(t){var e=t.getLocation().x-this._startPos.x;this.isLeft||(e=-e),this.Target.node.width=cc.misc.clampf(this._startWidth+e,this.Limit.x,this.Limit.y),this._updateDirty=!0},e.prototype.onMouseEnter=function(t){this._canvas.style.cursor="w-resize"},e.prototype.onMouseLeave=function(t){this._canvas.style.cursor="default "},o([u(cc.Widget)],e.prototype,"Target",void 0),o([u(cc.Vec2)],e.prototype,"Limit",void 0),o([u({tooltip:!1})],e.prototype,"isLeft",void 0),e=o([c],e)}(cc.Component);n.default=h,cc._RF.pop()},{"../../editor/Setting":"Setting","../util/Events":"Events"}],Res:[function(t,e,n){"use strict";cc._RF.push(e,"1d842PHcd1Be43zi5yD4Ulr","Res");var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,a){function r(t){try{c(i.next(t))}catch(t){a(t)}}function s(t){try{c(i.throw(t))}catch(t){a(t)}}function c(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(r,s)}c((i=i.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){var n,i,o,a,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(t){return function(e){return c([t,e])}}function c(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=2&a[0]?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,i=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(o=(o=r.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(t){a=[6,t],i=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(){}return t.getLoaded=function(t){var e=this._cacheMap.get(t);return void 0===e?(cc.error("[Res.getLoaded] error: \u8d44\u6e90\u672a\u52a0\u8f7d"),null):e},t.load=function(t,e){return i(this,void 0,Promise,function(){var n,i=this;return o(this,function(o){switch(o.label){case 0:return(n=this._cacheMap.get(t))?[2,n]:[4,new Promise(function(n,o){cc.loader.loadRes(t,e,function(e,o){e?(cc.error("[Res.load] error: "+e),n(null)):(i._cacheMap.set(t,o),n(o))})})];case 1:return[2,o.sent()]}})})},t.loadDir=function(t,e){return i(this,void 0,Promise,function(){var n=this;return o(this,function(i){switch(i.label){case 0:return[4,new Promise(function(i,o){cc.loader.loadResDir(t,e,function(t,e,o){t?(cc.error("[Res.loadDir] error: "+t),i([])):(o.forEach(function(t,i){n._cacheMap.set(t,e[i])}),i(e))})})];case 1:return[2,i.sent()]}})})},t._cacheMap=new Map,t}();n.default=a,cc._RF.pop()},{}],Setting:[function(t,e,n){"use strict";cc._RF.push(e,"e82bcQSlt9L/KGQLLFzkIy9","Setting"),Object.defineProperty(n,"__esModule",{value:!0});var i=t("./Editor"),o=function(){function t(){}return Object.defineProperty(t,"inspectorWidth",{get:function(){return this._inspectorWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t,"parametersWidth",{get:function(){return this._parametersWidth},enumerable:!0,configurable:!0}),t.read=function(){var t=cc.sys.localStorage.getItem("setting");if(t){var e=JSON.parse(t);e&&(e.inspectorWidth&&(this._inspectorWidth=e.inspectorWidth),e.parametersWidth&&(this._parametersWidth=e.parametersWidth))}},t.save=function(){this._inspectorWidth=i.default.Inst.Inspector.node.width,this._parametersWidth=i.default.Inst.Parameters.node.width;var t={inspectorWidth:this._inspectorWidth,parametersWidth:this._parametersWidth};cc.sys.localStorage.setItem("setting",JSON.stringify(t))},t._inspectorWidth=400,t._parametersWidth=300,t}();n.default=o,cc._RF.pop()},{"./Editor":"Editor"}],StateMachine:[function(t,e,n){"use strict";cc._RF.push(e,"81405A1SBxDfJPsioiVljka","StateMachine"),Object.defineProperty(n,"__esModule",{value:!0});var i=t("../../common/util/Events"),o=t("./State"),a=function(){function t(e){this._name="",this._position=cc.v2(0,0),this._layerPos=cc.v2(0,0),this._layerScale=1,this._anyStatePos=cc.v2(-360,300),this._upStateMachinePos=cc.v2(360,300),this._upStateMachine=null,this._subStateMachines=new Set,this._subStates=new Set,this._upStateMachine=e,this.isMain||(this._upStateMachine.add(this),this._name=t.getUniqueName(this),t.add(this))}return t.add=function(t){this._allSubStateMachines.add(t)},t.delete=function(t){this._allSubStateMachines.delete(t)},t.getUniqueName=function(t,e){void 0===e&&(e="StateMachine");for(var n=0,i=!1;!i;){i=!0;for(var o=this._allSubStateMachines.values(),a=0;a<this._allSubStateMachines.size;a++){var r=o.next().value;if(r!==t&&r._name===""+e+(n>0?n:"")){n++,i=!1;break}}}return""+e+(n>0?n:"")},Object.defineProperty(t.prototype,"name",{get:function(){return this.isMain?"BaseLayer":this._name},set:function(e){this._name===e||this.isMain||(this._name=t.getUniqueName(this,e),i.default.emit(i.EventName.STATE_MACHINE_NAME_CHANGED,this))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"layerPos",{get:function(){return this._layerPos},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"layerScale",{get:function(){return this._layerScale},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anyStatePos",{get:function(){return this._anyStatePos},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"upStateMachinePos",{get:function(){return this._upStateMachinePos},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"upStateMachine",{get:function(){return this._upStateMachine},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subStateMachines",{get:function(){return this._subStateMachines},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subStates",{get:function(){return this._subStates},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isMain",{get:function(){return null===this._upStateMachine},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this.isMain||t.delete(this),this._subStateMachines.forEach(function(t){t.destroy()}),this._subStateMachines.clear(),this._subStates.forEach(function(t){t.destroy()}),this._subStates.clear()},t.prototype.changeUpStateMachine=function(t){this.isMain||(this._upStateMachine.delete(this,!1),this._upStateMachine=t,this._upStateMachine.add(this))},t.prototype.has=function(e,n){if(void 0===n&&(n=!0),this.isMain&&n)return!0;if(e instanceof o.default){if(!n)return this._subStates.has(e);if(this._subStates.has(e))return!0;for(var i=this._subStateMachines.values(),a=0;a<this._subStateMachines.size;a++){if(i.next().value.has(e))return!0}}else if(e instanceof t){if(!n)return this._subStateMachines.has(e);if(this._subStateMachines.has(e))return!0;for(i=this._subStateMachines.values(),a=0;a<this._subStateMachines.size;a++){if(i.next().value.has(e))return!0}}return!1},t.prototype.add=function(e){if(e instanceof o.default){if(e.isAnyState)return;this._subStates.add(e)}else e instanceof t&&this._subStateMachines.add(e)},t.prototype.delete=function(e,n){void 0===n&&(n=!0),n&&e.destroy(),e instanceof o.default?this._subStates.delete(e):e instanceof t&&this._subStateMachines.delete(e)},t.prototype.moveTargetIn=function(e){return e instanceof o.default?!this._subStates.has(e)&&(e.changeUpStateMachine(this),!0):e instanceof t&&(this!==e&&!this._subStateMachines.has(e)&&!e.has(this)&&(e.changeUpStateMachine(this),!0))},t.prototype.getAllSubStates=function(t){return void 0===t&&(t=new Set),this._subStates.forEach(function(e){t.add(e)}),this._subStateMachines.forEach(function(e){e.getAllSubStates(t)}),t},t.prototype.getAllOutStates=function(){var t=new Set,e=this.getAllSubStates();return o.default.getAllStates().forEach(function(n){e.has(n)||t.add(n)}),t},t.prototype.getSubTransitions=function(t,e,n){return this._subStates.forEach(function(i){e=e.concat(i.getTransitions(t,n))}),this._subStateMachines.forEach(function(i){e=i.getSubTransitions(t,e,n)}),e},t.prototype.getOutTransitions=function(t,e,n,i){return this._subStates.forEach(function(n){e=e.concat(n.getTransitions(t,i))}),this._subStateMachines.forEach(function(o){o!==n&&(e=o.getSubTransitions(t,e,i))}),this.isMain?e:e=this._upStateMachine.getOutTransitions(t,e,this,i)},t.prototype.getTransitions=function(t){var e=[];return e=this.has(t)?this.getOutTransitions(t,e,t.upStateMachine,t.upStateMachine):this.getSubTransitions(t,e,this._upStateMachine)},t.prototype.setPosition=function(t,e){void 0===e&&(e=0),this._position=cc.v2(t,e)},t.prototype.setLayerPos=function(t,e){void 0===e&&(e=0),this._layerPos=cc.v2(t,e)},t.prototype.setLayerScale=function(t){this._layerScale=t},t.prototype.setAnyStatePos=function(t,e){void 0===e&&(e=0),this._anyStatePos=cc.v2(t,e)},t.prototype.setUpStateMachinePos=function(t,e){void 0===e&&(e=0),this._upStateMachinePos=cc.v2(t,e)},t._allSubStateMachines=new Set,t}();n.default=a,cc._RF.pop()},{"../../common/util/Events":"Events","./State":"State"}],State:[function(t,e,n){"use strict";cc._RF.push(e,"9cc65WSQl5AQLGkbXwI4Sh2","State"),Object.defineProperty(n,"__esModule",{value:!0});var i=t("../../common/util/Events"),o=t("../../common/util/Tool"),a=t("./StateMachine"),r=t("./Transition"),s=function(){function t(e,n){this._name="",this.motion="",this._speed=1,this.multiplierParam=null,this.loop=!1,this._transitions=[],this._position=cc.v2(0,0),this._upStateMachine=null,this._isAnyState=!1,this._isAnyState=n,this._isAnyState||(this._upStateMachine=e,this._upStateMachine.add(this),this._name=t.getUniqueName(this),t.add(this))}return t.getAllStates=function(){return this._allStates},t.add=function(t){this._allStates.add(t)},t.delete=function(t){this._allStates.delete(t)},t.getUniqueName=function(t,e){void 0===e&&(e="State");for(var n=0,i=!1;!i;){i=!0;for(var o=this._allStates.values(),a=0;a<this._allStates.size;a++){var r=o.next().value;if(r!==t&&r._name===""+e+(n>0?n:"")){n++,i=!1;break}}}return""+e+(n>0?n:"")},t.getStateNum=function(){return this._allStates.size},t.getRandState=function(){return 0===this._allStates.size?null:this._allStates.values().next().value},Object.defineProperty(t.prototype,"name",{get:function(){return this._isAnyState?"AnyState":this._name},set:function(e){this._isAnyState||this._name===e||(this._name=t.getUniqueName(this,e),i.default.emit(i.EventName.STATE_NAME_CHANGED,this))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"speed",{get:function(){return this._speed},set:function(t){this._speed=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"upStateMachine",{get:function(){return this._upStateMachine},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isAnyState",{get:function(){return this._isAnyState},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this._isAnyState||t.delete(this),this._transitions.forEach(function(t){t.destroy()}),this._transitions.length=0},t.prototype.changeUpStateMachine=function(t){this._isAnyState||(this._upStateMachine.delete(this,!1),this._upStateMachine=t,this._upStateMachine.add(this))},t.prototype.addTransition=function(t){var e=new r.default(this,t);return o.default.arrayAdd(this._transitions,e),e},t.prototype.deleteTransition=function(t){o.default.arrayDelete(this._transitions,t)&&t.destroy()},t.prototype.getTransitions=function(e,n){void 0===e&&(e=null),void 0===n&&(n=null);var i=[];if(e instanceof t)this._transitions.forEach(function(t){e===t.toState&&i.push(t)});else if(e instanceof a.default)if(e.has(this)){if(!n)return cc.error("[State.getTransitions] error: cur is null"),i;this._transitions.forEach(function(t){n.has(t.toState)||i.push(t)})}else this._transitions.forEach(function(t){e.has(t.toState)&&i.push(t)});else i=this._transitions;return i},t.prototype.swapTransition=function(t,e){o.default.arraySwap(this._transitions,t,e)},t.prototype.moveTransition=function(t,e){o.default.arrayMove(this._transitions,t,e)},t.prototype.getMultiplierName=function(){return this.multiplierParam?this.multiplierParam.paramName:""},t.prototype.setPosition=function(t,e){void 0===e&&(e=0),this._position=cc.v2(t,e)},t.prototype.getAllTransitionData=function(){var t=[];return this.getTransitions().forEach(function(e){t.push(e.getTransitionData())}),t},t._allStates=new Set,t}();n.default=s,cc._RF.pop()},{"../../common/util/Events":"Events","../../common/util/Tool":"Tool","./StateMachine":"StateMachine","./Transition":"Transition"}],Tool:[function(t,e,n){"use strict";cc._RF.push(e,"8a83bcz3U5LPaoeEh9Yuk+I","Tool"),Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(){}return t.randArray=function(t){return t.length<=0?null:t[this.randInt(0,t.length-1)]},t.randInt=function(t,e){return(t=Math.ceil(t))>=(e=Math.floor(e))?e:Math.floor(Math.random()*(e-t+1))+t},t.randFloat=function(t,e){return t>=e?e:Math.random()*(e-t)+t},t.inRange=function(t,e,n,i){return void 0===i&&(i=!0),i?n>=t&&n<=e:n>t&&n<e},t.arrayHas=function(t,e){return t.findIndex(function(t){return t===e})>=0},t.arraySwap=function(t,e,n){var i;e!==n&&this.inRange(0,t.length-1,e)&&this.inRange(0,t.length-1,n)&&(i=[t[n],t[e]],t[e]=i[0],t[n]=i[1])},t.arrayMove=function(t,e,n){if(e!==n&&this.inRange(0,t.length-1,e)&&this.inRange(0,t.length-1,n)){var i=t.splice(e,1);t.splice(n,0,i[0])}},t.arrayAdd=function(t,e,n){return void 0===n&&(n=!1),!(!n&&this.arrayHas(t,e))&&(t.push(e),!0)},t.arrayDelete=function(t,e){var n=t.findIndex(function(t){return t===e});return-1!==n&&(t.splice(n,1),!0)},t.updateWidget=function(t){for(var e=this,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];t.children.forEach(function(t){var i=t.getComponent(cc.Widget);i&&i.updateAlignment(),e.arrayHas(n,t)||e.updateWidget.apply(e,[t].concat(n))})},t}();n.default=i,cc._RF.pop()},{}],TransitionItem:[function(t,e,n){"use strict";cc._RF.push(e,"7372eZ1ldFLxpalJlrK/kxY","TransitionItem");var i=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),o=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0});var a=t("../../common/util/Events"),r=cc._decorator,s=r.ccclass,c=r.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.Bg=null,e.Arrow=null,e.Label=null,e.transition=null,e}return i(e,t),e.prototype.reuse=function(){},e.prototype.unuse=function(){a.default.targetOff(this)},e.prototype.onInit=function(t,e){this.Bg.opacity=0,this.Arrow.active=!!e,this.transition=t,this.Label.string=this.transition.getTransStr(),a.default.targetOn(this)},e.prototype.onLoad=function(){this.Bg.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this)},e.prototype.onDestroy=function(){a.default.targetOff(this)},e.prototype.onTouchStart=function(){a.default.emit(a.EventName.TRANSITION_SELECT,this)},e.prototype.select=function(t){this.Bg.opacity=t?255:0},e.prototype.delete=function(){this.transition.fromState.deleteTransition(this.transition),a.default.emit(a.EventName.TRANSITION_DELETE,this.transition)},e.prototype.onEventStateChanged=function(t){this.Label.string=this.transition.getTransStr()},o([c(cc.Node)],e.prototype,"Bg",void 0),o([c(cc.Node)],e.prototype,"Arrow",void 0),o([c(cc.Label)],e.prototype,"Label",void 0),o([a.preloadEvent(a.EventName.STATE_NAME_CHANGED)],e.prototype,"onEventStateChanged",null),e=o([s],e)}(cc.Component);n.default=u,cc._RF.pop()},{"../../common/util/Events":"Events"}],Transition:[function(t,e,n){"use strict";cc._RF.push(e,"c5d54pO1OdMeauETugaBjPb","Transition");var i=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0});var o=t("../../common/util/Events"),a=t("../../common/util/Tool"),r=t("./Condition"),s=function(){function t(t,e){this._fromState=null,this._toState=null,this._conditions=[],this.hasExitTime=!1,this._fromState=t,this._toState=e,o.default.targetOn(this)}return Object.defineProperty(t.prototype,"fromState",{get:function(){return this._fromState},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"toState",{get:function(){return this._toState},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"conditions",{get:function(){return this._conditions},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this._conditions.forEach(function(t){t.destroy()}),this._conditions.length=0,o.default.targetOff(this)},t.prototype.getTransStr=function(){return this._fromState.name+" -> "+this._toState.name},t.prototype.addCondition=function(t){var e=new r.default(t);return a.default.arrayAdd(this._conditions,e),e},t.prototype.deleteCondition=function(t){a.default.arrayDelete(this._conditions,t)&&t.destroy()},t.prototype.moveCondition=function(t,e){a.default.arrayMove(this._conditions,t,e)},t.prototype.getTransitionData=function(){var t={toState:this.toState.name,hasExitTime:this.hasExitTime,conditions:[]};return this._conditions.forEach(function(e){t.conditions.push(e.getConditionData())}),t},t.prototype.onEventParamDelete=function(t){for(var e=this._conditions.length-1;e>=0;e--)this._conditions[e].paramItem===t&&this._conditions.splice(e,1)},i([o.preloadEvent(o.EventName.PARAM_DELETE)],t.prototype,"onEventParamDelete",null),t}();n.default=s,cc._RF.pop()},{"../../common/util/Events":"Events","../../common/util/Tool":"Tool","./Condition":"Condition"}],UnitBase:[function(t,e,n){"use strict";cc._RF.push(e,"de0eeVqQ15NY7dzwz8HOan1","UnitBase");var i=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),o=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0});var a=cc._decorator,r=a.ccclass,s=a.property;n.UnitColor={NORMAL:cc.color(150,150,150),DEFAULT:cc.color(210,120,70),ANY_STATE:cc.color(92,190,199)};var c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.SelectNode=null,e.BgNode=null,e.NameLabel=null,e._isDefault=!1,e}return i(e,t),Object.defineProperty(e.prototype,"isDefault",{get:function(){return this._isDefault},set:function(t){this._isDefault=t,this.BgNode.color=this._isDefault?n.UnitColor.DEFAULT:n.UnitColor.NORMAL},enumerable:!0,configurable:!0}),e.prototype.select=function(t){this.SelectNode.active=t,this.node.setSiblingIndex(this.node.parent.childrenCount-1)},e.prototype.addTransition=function(t,e){},e.prototype.getTransitions=function(t){return void 0===t&&(t=null),[]},e.prototype.setPos=function(t,e){void 0===e&&(e=0);var n=cc.v2(t,e);return n=cc.v2(30*Math.round(n.x/30),30*Math.round(n.y/30)),this.node.position=n,n},o([s(cc.Node)],e.prototype,"SelectNode",void 0),o([s(cc.Node)],e.prototype,"BgNode",void 0),o([s(cc.Label)],e.prototype,"NameLabel",void 0),e=o([r],e)}(cc.Component);n.default=c,cc._RF.pop()},{}],UnitStateMachine:[function(t,e,n){"use strict";cc._RF.push(e,"f37b5aQnaBBQa4/iFSORZgx","UnitStateMachine");var i=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),o=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0});var a=t("../../common/util/Events"),r=t("../data/StateMachine"),s=t("./UnitBase"),c=t("./UnitState"),u=cc._decorator,h=u.ccclass,l=(u.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._stateMachine=null,e._isUp=!1,e}var n;return i(e,t),n=e,Object.defineProperty(e.prototype,"stateMachine",{get:function(){return this._stateMachine},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isUp",{get:function(){return this._isUp},set:function(t){this._isUp=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isDefault",{get:function(){return this._isDefault},set:function(t){this._isDefault=t,this.BgNode.color=this._isDefault?s.UnitColor.DEFAULT:s.UnitColor.NORMAL},enumerable:!0,configurable:!0}),e.prototype.onInit=function(t){this._stateMachine=new r.default(t),this.NameLabel.string=(this.isUp?"(up)":"")+this._stateMachine.name},e.prototype.initByStateMachine=function(t,e){void 0===e&&(e=null),this._stateMachine=t,this.isUp=!!e,this.NameLabel.string=(this.isUp?"(up)":"")+this._stateMachine.name,this.node.position=this.isUp?e:t.position},e.prototype.onLoad=function(){a.default.targetOn(this)},e.prototype.onDestroy=function(){a.default.targetOff(this)},e.prototype.getTransitions=function(t){return void 0===t&&(t=null),t instanceof c.default?this.stateMachine.getTransitions(t.state):t instanceof n?this.stateMachine.getTransitions(t.stateMachine):[]},e.prototype.setPos=function(e,n){void 0===n&&(n=0);var i=t.prototype.setPos.call(this,e,n);return this.stateMachine.position.equals(i)||(this.isUp?a.default.emit(a.EventName.UP_STATE_MACHINE_MOVE,i):this.stateMachine.setPosition(i)),i},e.prototype.onEventStateNameChanged=function(t){this.stateMachine===t&&(this.NameLabel.string=(this.isUp?"(up)":"")+this.stateMachine.name)},o([a.preloadEvent(a.EventName.STATE_MACHINE_NAME_CHANGED)],e.prototype,"onEventStateNameChanged",null),e=n=o([h],e)}(s.default));n.default=l,cc._RF.pop()},{"../../common/util/Events":"Events","../data/StateMachine":"StateMachine","./UnitBase":"UnitBase","./UnitState":"UnitState"}],UnitState:[function(t,e,n){"use strict";cc._RF.push(e,"93004C4InVHzrfgMWEwjPxv","UnitState");var i=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),o=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0});var a=t("../../common/util/Events"),r=t("../data/State"),s=t("./UnitBase"),c=t("./UnitStateMachine"),u=cc._decorator,h=u.ccclass,l=(u.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._state=null,e}var n;return i(e,t),n=e,Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAnyState",{get:function(){return this._state.isAnyState},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isDefault",{get:function(){return this._isDefault},set:function(t){this.isAnyState||(this._isDefault=t,this.BgNode.color=this._isDefault?s.UnitColor.DEFAULT:s.UnitColor.NORMAL)},enumerable:!0,configurable:!0}),e.prototype.onInit=function(t,e){void 0===e&&(e=!1),this._state=new r.default(t,e),e?(this.node.scale*=.8,this.NameLabel.node.scale*=1.25,this.BgNode.color=s.UnitColor.ANY_STATE,this.NameLabel.string="AnyState"):this.NameLabel.string=this._state.name},e.prototype.initByState=function(t){this._state=t,this.NameLabel.string=this._state.name,this.node.position=t.position},e.prototype.onLoad=function(){a.default.targetOn(this)},e.prototype.onDestroy=function(){a.default.targetOff(this)},e.prototype.addTransition=function(t,e){var n=this.state.addTransition(e);a.default.emit(a.EventName.TRANSITION_ADD,this,t,n)},e.prototype.getTransitions=function(t){return void 0===t&&(t=null),t instanceof n?this.state.getTransitions(t.state):t instanceof c.default?this.state.getTransitions(t.stateMachine,this._state.upStateMachine):this.state.getTransitions()},e.prototype.setPos=function(e,n){void 0===n&&(n=0);var i=t.prototype.setPos.call(this,e,n);return this.state.position.equals(i)||(this.state.setPosition(i),this.isAnyState&&a.default.emit(a.EventName.ANY_STATE_MOVE,i)),i},e.prototype.onEventStateNameChanged=function(t){this.state===t&&(this.NameLabel.string=t.name)},o([a.preloadEvent(a.EventName.STATE_NAME_CHANGED)],e.prototype,"onEventStateNameChanged",null),e=n=o([h],e)}(s.default));n.default=l,cc._RF.pop()},{"../../common/util/Events":"Events","../data/State":"State","./UnitBase":"UnitBase","./UnitStateMachine":"UnitStateMachine"}]},{},["CanvasAdapt","DragItem","DragList","ResizeArea","Events","RecyclePool","Res","Tool","BaseConst","ResUrl","Editor","Setting","Condition","State","StateMachine","Transition","BarItem","FsmCtr","Line","MachineLayer","NavBar","UnitBase","UnitState","UnitStateMachine","ConditionItem","InspectorCtr","TransitionItem","LineToSubItem","Menu","MultiplierItem","ParamSelectItem","ParamCtr","ParamItem","Main"]);